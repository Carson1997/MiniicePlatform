!function(e){var t={};function a(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,o){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(a.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(o,r,function(t){return e[t]}.bind(null,r));return o},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t){new Vue({el:"#vue",data:{send:{date:"2020-06-01_2020-06-30",date_type:"1"},time_data:{start_time:"",end_time:""},dateValue:"",dateType:"daterange",selectDate:"---",defaultValue:"",dataType:1,pickOption:{firstDayOfWeek:1,disabledDate:function(e){}},pickOptionMonth:{firstDayOfWeek:1,disabledDate:function(e){}},selectDateShow:"2020-06-01_2020-06-30",daterange:[],monthrange:[],sel_pla:[],sel_shop:[],sel_category1:[],sel_category2:[],sel_category3:[],sel_brand:[]},created(){window.tClick1=this.tClick1},mounted:function(){this.initLayui(),this.initConTop(),this.initSelect(),this.getShop()},methods:{mergeHandle:function(e){this.defaultValue=e.end_time,limitDayBegin=new Date(e.start_time.replace("-","/")).getTime(),limitDayEnd=new Date(e.end_time.replace("-","/")).getTime(),this.pickOption.disabledDate=function(e){if(limitDayBegin>e.getTime()||limitDayEnd<e.getTime())return e};var t=moment(limitDayEnd).endOf("month").format("YYYY-MM-DD"),a=limitDayEnd;if(e.end_time!=t){var o=moment(e.end_time).subtract(1,"months").format("YYYY-MM-DD");a=moment(o).endOf("month").format("YYYY-MM-DD"),a=new Date(a).getTime()}this.pickOptionMonth.disabledDate=function(e){return a>limitDayBegin?limitDayBegin>e.getTime()||a<e.getTime()?e:void 0:e}},selectLis:function(e,t){this.dataType=t;var a=this.time_data;this.dateType!=e?(this.dateValue="",this.dateType=e,this.mergeHandle(a)):this.mergeHandle(a),"daterange"==e&&$("#datePicker1").find(".el-date-editor--daterange")[0].click(),"week"==e&&($("#datePicker1").find(".el-date-editor--daterange")[1].click(),$(".available").removeClass("in-range start-date"),$(".available").removeClass("in-range end-date")),"monthrange"==e&&$("#datePicker1").find(".el-date-editor--monthrange").click()},dateClick:function(e){$(".wordClick").removeClass("wordClick");var t="";if("date"==this.dateType)t=e+"_"+e,$($(".word")[0]).addClass("wordClick");else if("week"==this.dateType){t=(a=moment(e).isoWeekday(1).week(moment(e).isoWeekday(1).week()).startOf("isoweek").format("YYYY-MM-DD"))+"_"+(o=moment(e).isoWeekday(1).week(moment(e).isoWeekday(1).week()).endOf("isoweek").format("YYYY-MM-DD")),$($(".word")[1]).addClass("wordClick")}else if("month"==this.dateType){t=(a=moment(e).month(moment(e).month()).startOf("month").format("YYYY-MM-DD"))+"_"+(o=moment(e).month(moment(e).month()).endOf("month").format("YYYY-MM-DD")),$($(".word")[2]).addClass("wordClick")}if(this.selectDate=t,"week"==this.dateType){$($(".word")[1]).addClass("wordClick"),this.send.date_type=2;var a=moment(e[0]).isoWeekday(1).week(moment(e[0]).isoWeekday(1).week()).startOf("isoweek").format("YYYY-MM-DD"),o=moment(e[1]).isoWeekday(1).week(moment(e[1]).isoWeekday(1).week()).endOf("isoweek").format("YYYY-MM-DD");this.selectDateShow=a+"_"+o,this.send.date=this.selectDateShow}if("daterange"==this.dateType&&($($(".word")[0]).addClass("wordClick"),this.selectDateShow=e[0]+"_"+e[1],this.send.date=this.selectDateShow,this.send.date_type=1),"monthrange"==this.dateType){$($(".word")[2]).addClass("wordClick");t=(a=moment(e[0]).month(moment(e[0]).month()).startOf("month").format("YYYY-MM-DD"))+"_"+(o=moment(e[1]).month(moment(e[1]).month()).endOf("month").format("YYYY-MM-DD"));this.selectDateShow=e[0].substr(0,7)+"_"+e[1].substr(0,7),this.send.date=t,this.send.date_type=3}this.daterange="",this.dateValue="",this.monthrange="",this.getGoodsData()},getShop(){var e=this;addLoading(),$.ajax({url:url_shop,type:"get",dataType:"json",timeout:1e4,success:function(t){removeLoading(),checkStatus(t,(function(){var a=t.data;e.fillShopSelect(a),t.data.length>0&&(e.time_data.start_time=t.data[0].data_star,e.time_data.end_time=t.data[0].data_end,e.selectDateShow=t.data[0].data_star+"_"+t.data[0].data_end,e.daterange=[t.data[0].data_star,t.data[0].data_end],e.send.date=e.selectDateShow),e.getGoodsData()}))},error:function(){removeLoading(),layer.alert("请求失败")}})},fillShopSelect(e){for(var t in e){var a=e[t];e[t].name=e[t].shop_name+"("+changePlatform(a.platform)+")",e[t].value=e[t].id}this.arr_shop=e,this.selectMore("#xm-shop",e)},getGoodsData(){var e=this;addLoading(),$.ajax({url:url_shop_detail,type:"post",dataType:"json",data:e.send,timeout:1e4,success:function(t){removeLoading(),checkStatus(t,(function(){e.allGoodsData=t.data,e.filterData(1)}))},error:function(){removeLoading(),layer.alert("请求失败")}})},filterData(e){var t=this;for(var a in t.goods_data=[],1==e&&(t.arr_category1=[],t.arr_category2=[],t.arr_category3=[],t.arr_brand=[]),t.allGoodsData){var o=t.allGoodsData[a];o.payment_amt=parseFloat(o.payment_amt).toFixed(2),o.shop_name=changeShopName(o.shop_id,t.arr_shop),o.pay_conversion_rate=(100*changeChu(o.payment_collect_qty,o.visitors)).toFixed(2),o.customer_price=changeChu(o.payment_amt,o.payment_collect_qty).toFixed(0),o.unit_price=changeChu(o.payment_amt,o.payment_qty).toFixed(0),1==e&&r(o),t.goods_data.push(o)}function r(e){function a(t,a){0==t.hasOwnProperty(e[a])&&""!=e[a]&&(t[e[a]]={name:e[a],value:e[a]},"category2"==a&&(t[e[a]].parent=e.category1),"category3"==a&&(t[e[a]].parent=e.category2))}a(t.arr_category1,"category1"),a(t.arr_category2,"category2"),a(t.arr_category3,"category3"),a(t.arr_brand,"brand")}function i(e,t,a){if(!t||!e)return[];var o=t;return e.length>0&&(o=t.filter((function(t){if(e.indexOf(t[a])>-1&&""!=t[a])return t}))),"全部"==e&&(o=t),o}1==e&&(t.arr_category1=Object.values(t.arr_category1),t.arr_category2=Object.values(t.arr_category2),t.arr_category3=Object.values(t.arr_category3),t.arr_brand=Object.values(t.arr_brand),t.selectRadio("#xm-category1",Object.values(t.arr_category1)),t.selectRadio("#xm-category2",Object.values(t.arr_category2)),t.selectRadio("#xm-category3",Object.values(t.arr_category3)),t.selectMore("#xm-brand",Object.values(t.arr_brand))),t.goods_data=i(t.sel_pla,t.goods_data,"platform"),t.goods_data=i(t.sel_shop,t.goods_data,"shop_id"),t.goods_data=i(t.sel_category1,t.goods_data,"category1"),t.goods_data=i(t.sel_category2,t.goods_data,"category2"),t.goods_data=i(t.sel_category3,t.goods_data,"category3"),t.goods_data=i(t.sel_brand,t.goods_data,"brand"),this.fillTable()},initLayui(){var e=this,t=layui.form;t.render(),t.on("checkbox(dx)",(function(t){var a=t.value,o=!t.elem.checked;e.title[a].hide=o,layui.table.reload("table_goods",{cols:[e.title]})}))},initConTop(){var e=$(".fixedTitle").height()+10;$(".layui-fluid").css("margin-top",e)},initSelect(){this.arr_pla=[{name:"淘宝",value:1},{name:"京东",value:2},{name:"苏宁",value:3},{name:"猫宁",value:4}],this.arr_shop=[],this.selectMore("#xm-platform",this.arr_pla)},selectRadio(e,t){var a=this;xmSelect.render({direction:"down",el:e,size:"mini",radio:!0,height:"auto",toolbar:{show:!0,showIcon:!1,list:["CLEAR"]},filterable:!0,model:{icon:"hidden",label:{type:"text"}},theme:{color:"#ED6D00"},data:t,on:function(t){if("#xm-category1"==e){if(a.sel_category1=[],a.sel_category2=[],a.sel_category3=[],t.arr.length>0){var o=[];a.sel_category1=t.arr.map((function(e){return a.arr_category2.forEach((function(t){e.value==t.parent&&o.push(t)})),e.value.toString()})),a.selectRadio("#xm-category2",o);var r=[];o.forEach((function(e){a.arr_category3.forEach((function(t){e.value==t.parent&&r.push(t)}))})),a.selectRadio("#xm-category3",r)}else a.selectRadio("#xm-category2",a.arr_category2),a.selectRadio("#xm-category3",a.arr_category3);a.filterData()}if("#xm-category2"==e){if(a.sel_category2=[],a.sel_category3=[],t.arr.length>0){o=[];a.sel_category2=t.arr.map((function(e){return a.arr_category3.forEach((function(t){e.value==t.parent&&o.push(t)})),e.value.toString()})),a.selectRadio("#xm-category3",o)}else a.selectRadio("#xm-category3",a.arr_category3);a.filterData()}"#xm-category3"==e&&(a.sel_category3=[],t.arr.length>0&&(a.sel_category3=t.arr.map((function(e){return e.value.toString()}))),a.filterData())}})},selectMore(e,t){var a=this;xmSelect.render({direction:"down",el:e,size:"mini",height:"auto",toolbar:{show:!0,showIcon:!1,list:["CLEAR"]},filterable:!0,model:{label:{type:"text"}},theme:{color:"#ED6D00"},data:t,on:function(t){if("#xm-platform"==e){if(a.sel_pla=[],a.sel_shop=[],t.arr.length>0){var o=[];a.sel_pla=t.arr.map((function(e){return a.arr_shop.forEach((function(t){e.value==t.platform&&o.push(t)})),e.value.toString()})),a.selectMore("#xm-shop",o)}else a.selectMore("#xm-shop",a.arr_shop);a.filterData()}"#xm-shop"==e&&(a.sel_shop=[],t.arr.length>0&&(a.sel_shop=t.arr.map((function(e){return e.value.toString()}))),a.filterData()),"#xm-brand"==e&&(a.sel_brand=[],t.arr.length>0&&(a.sel_brand=t.arr.map((function(e){return e.value.toString()}))),a.filterData())}})},clickTitleIcon(){var e,t,a=$(".titleIcon i").attr("class"),o=$(".fixedTitle").height(),r=$(".layui-fluid").offset().top;-1!=a.indexOf("layui-icon-up")?(this.content_top=r,e=10,t=o,$(".titleIcon i").attr("class","layui-icon layui-icon-down")):($(".titleIcon i").attr("class","layui-icon layui-icon-up"),e=this.content_top,t=0),$(".fixedTitle").animate({"margin-top":"-"+t},".1s"),$(".layui-fluid").animate({"margin-top":e},".1s")},fillTable(){var e=layui.table;this.title=[{field:"shop_name",title:"店铺",sort:!1,minWidth:170},{field:"model_num",title:"商品",sort:!1,minWidth:170},{field:"payment_amt",title:"支付金额(元)",sort:!1,minWidth:130},{field:"payment_qty",title:"支付件数(件)",sort:!1,minWidth:130},{field:"visitors",title:"访客数(人)",sort:!1,minWidth:130},{field:"shopping_cart",title:"加购人数(人)",sort:!1,minWidth:130},{field:"payment_collect_qty",title:"支付买家数(人)",sort:!1,minWidth:130},{field:"pay_conversion_rate",title:"支付转化率(%)",sort:!1,minWidth:130},{field:"customer_price",title:"客单价(元)",sort:!1,minWidth:130},{field:"unit_price",title:"件单价(元)",sort:!1,minWidth:130},{title:"操作",minWidth:90,templet:function(e){var t=e.prd_id;return'<span class="tClick" prd_id='+t+' onclick="tClick1('+t+')">商品分析</span>'}}],e.render({id:"table_goods",elem:"#table_goods",data:this.goods_data,cols:[this.title],limit:10,page:!0})},tClick1(e){localStorage.prd_id=e,parent.$(".s-level").each((function(){"商品分析"==$(this).text()&&$(this).click()}))}}})}]);