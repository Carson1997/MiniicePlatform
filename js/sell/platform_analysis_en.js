!function(t){var e={};function a(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=e,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(i,n,function(e){return t[e]}.bind(null,n));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=0)}([function(t,e,a){t.exports=a(1)},function(t,e){new Vue({el:"#vue",data:{send:{date:"2020-06-01_2020-06-30",date_type:"1"},time_data:{start_time:"",end_time:""},dateValue:"",dateType:"daterange",selectDate:"---",defaultValue:"",dataType:1,pickOption:{firstDayOfWeek:1,disabledDate:function(t){}},pickOptionMonth:{firstDayOfWeek:1,disabledDate:function(t){}},selectDateShow:"2020-06-01_2020-06-30",daterange:[],monthrange:[],sel_pla:["1","2","3","4"],payment_amt:[],payment_qty:[],visitors:[],shopping_cart:[],payment_collect_qty:[],pay_conversion_rate:[],customer_price:[],unit_price:[],s_tar:"payment_amt"},mounted:function(){this.initLayui(),this.initConTop(),this.initSelect(),this.initHeZiClick(),this.getShop()},methods:{mergeHandle:function(t){this.defaultValue=t.end_time,limitDayBegin=new Date(t.start_time.replace("-","/")).getTime(),limitDayEnd=new Date(t.end_time.replace("-","/")).getTime(),this.pickOption.disabledDate=function(t){if(limitDayBegin>t.getTime()||limitDayEnd<t.getTime())return t};var e=moment(limitDayEnd).endOf("month").format("YYYY-MM-DD"),a=limitDayEnd;if(t.end_time!=e){var i=moment(t.end_time).subtract(1,"months").format("YYYY-MM-DD");a=moment(i).endOf("month").format("YYYY-MM-DD"),a=new Date(a).getTime()}this.pickOptionMonth.disabledDate=function(t){return a>limitDayBegin?limitDayBegin>t.getTime()||a<t.getTime()?t:void 0:t}},selectLis:function(t,e){this.dataType=e;var a=this.time_data;this.dateType!=t?(this.dateValue="",this.dateType=t,this.mergeHandle(a)):this.mergeHandle(a),"daterange"==t&&$("#datePicker1").find(".el-date-editor--daterange")[0].click(),"week"==t&&($("#datePicker1").find(".el-date-editor--daterange")[1].click(),$(".available").removeClass("in-range start-date"),$(".available").removeClass("in-range end-date")),"monthrange"==t&&$("#datePicker1").find(".el-date-editor--monthrange").click()},dateClick:function(t){$(".wordClick").removeClass("wordClick");var e="";if("date"==this.dateType)e=t+"_"+t,$($(".word")[0]).addClass("wordClick");else if("week"==this.dateType){e=(a=moment(t).isoWeekday(1).week(moment(t).isoWeekday(1).week()).startOf("isoweek").format("YYYY-MM-DD"))+"_"+(i=moment(t).isoWeekday(1).week(moment(t).isoWeekday(1).week()).endOf("isoweek").format("YYYY-MM-DD")),$($(".word")[1]).addClass("wordClick")}else if("month"==this.dateType){e=(a=moment(t).month(moment(t).month()).startOf("month").format("YYYY-MM-DD"))+"_"+(i=moment(t).month(moment(t).month()).endOf("month").format("YYYY-MM-DD")),$($(".word")[2]).addClass("wordClick")}if(this.selectDate=e,"week"==this.dateType){$($(".word")[1]).addClass("wordClick"),this.send.date_type=2;var a=moment(t[0]).isoWeekday(1).week(moment(t[0]).isoWeekday(1).week()).startOf("isoweek").format("YYYY-MM-DD"),i=moment(t[1]).isoWeekday(1).week(moment(t[1]).isoWeekday(1).week()).endOf("isoweek").format("YYYY-MM-DD");this.selectDateShow=a+"_"+i,this.send.date=this.selectDateShow}if("daterange"==this.dateType&&($($(".word")[0]).addClass("wordClick"),this.selectDateShow=t[0]+"_"+t[1],this.send.date=this.selectDateShow,this.send.date_type=1),"monthrange"==this.dateType){$($(".word")[2]).addClass("wordClick");e=(a=moment(t[0]).month(moment(t[0]).month()).startOf("month").format("YYYY-MM-DD"))+"_"+(i=moment(t[1]).month(moment(t[1]).month()).endOf("month").format("YYYY-MM-DD"));this.selectDateShow=t[0].substr(0,7)+"_"+t[1].substr(0,7),this.send.date=e,this.send.date_type=3}this.daterange="",this.dateValue="",this.monthrange="",this.getPlaData()},initLayui(){var t=this,e=layui.form;function a(a,i){e.on(a,(function(e){var a=e.value,n=!e.elem.checked;t.title[a].hide=n,layui.table.reload(i,{cols:[t.title]})}))}e.render(),a("checkbox(dx1)","table_brand"),a("checkbox(dx2)","table_category"),a("checkbox(dx3)","table_shop")},initConTop(){var t=$(".fixedTitle").height()+10;$(".layui-fluid").css("margin-top",t)},initSelect(){this.arr_pla=[{name:"淘宝",value:1,selected:!0},{name:"京东",value:2,selected:!0},{name:"苏宁",value:3,selected:!0},{name:"猫宁",value:4,selected:!0}],this.arr_shop=[],this.selectMore("#xm-platform",this.arr_pla)},selectMore(t,e){var a=this;xmSelect.render({direction:"down",el:t,size:"mini",height:"auto",toolbar:{show:!0,showIcon:!1,list:["CLEAR"]},filterable:!0,model:{label:{type:"text"}},theme:{color:"#ED6D00"},data:e,on:function(t){a.sel_pla=[],t.arr.length>0&&(a.sel_pla=t.arr.map((function(t){return t.value.toString()}))),a.filterData()}})},clickTitleIcon(){var t,e,a=$(".titleIcon i").attr("class"),i=$(".fixedTitle").height(),n=$(".layui-fluid").offset().top;-1!=a.indexOf("layui-icon-up")?(this.content_top=n,t=10,e=i,$(".titleIcon i").attr("class","layui-icon layui-icon-down")):($(".titleIcon i").attr("class","layui-icon layui-icon-up"),t=this.content_top,e=0),$(".fixedTitle").animate({"margin-top":"-"+e},".1s"),$(".layui-fluid").animate({"margin-top":t},".1s")},initHeZiClick(){var t=this;$(".myBorderHeZi").click((function(){$(this).siblings().removeClass("selectHezi"),$(this).addClass("selectHezi"),t.s_tar=$(this).attr("data"),t.fillEachart()}))},getShop(){var t=this;addLoading(),$.ajax({url:url_shop,type:"get",dataType:"json",timeout:1e4,success:function(e){removeLoading(),checkStatus(e,(function(){t.allShopNameData=e.data,e.data.length>0&&(t.time_data.start_time=e.data[0].data_star,t.time_data.end_time=e.data[0].data_end,t.selectDateShow=e.data[0].data_end+"_"+e.data[0].data_end,t.daterange=[e.data[0].data_star,e.data[0].data_end],t.send.date=t.selectDateShow),t.getPlaData()}))},error:function(){removeLoading(),layer.alert("请求失败")}})},getPlaData(){var t=this;addLoading(),$.ajax({url:url_pla,type:"get",data:t.send,dataType:"json",timeout:1e4,success:function(e){removeLoading(),checkStatus(e,(function(){t.allPlaData=e.data.pro_data,t.allShopData=e.data.shop_data,t.filterData()}))},error:function(){removeLoading(),layer.alert("请求失败")}})},filterData(){this.payment_amt=[],this.payment_qty=[],this.visitors=[],this.shopping_cart=[],this.payment_collect_qty=[],this.pay_conversion_rate=[],this.customer_price=[],this.unit_price=[],this.pla_data=[],this.date_arr=[],this.shopData=[];var t=this.allPlaData;for(var e in function(e,a,i){var n=a;e.length>0&&(n=n.filter((function(t){if(e.indexOf(t[i])>-1)return t})));t=n}(this.sel_pla,t,"platform"),this.sel_pla){var a=this.sel_pla[e];this.pla_data[a]=[],this.shopData[a]=[]}for(var i in t){(d=t[i]).shop_name=this.changeShopName(d.shop_id,this.allShopNameData);var n=d.statistics_date;0==this.date_arr.hasOwnProperty(n)&&(this.date_arr[n]=[]),this.date_arr[n].push(d);var r=d.platform;this.pla_data[r]&&this.pla_data[r].push(d)}for(var i in this.pla_data){var o,l,s,d=this.pla_data[i],m=0,h=0,c=0,p=0,u=0;for(var _ in d){var f=d[_];m=changeSum(m,f.payment_amt),h=changeSum(h,f.payment_qty),c=changeSum(c,f.visitors),p=changeSum(p,f.shopping_cart),u=changeSum(u,f.payment_collect_qty)}this.payment_amt.push({pla:changePlatform(i),data:m}),this.payment_qty.push({pla:changePlatform(i),data:h}),this.visitors.push({pla:changePlatform(i),data:c}),this.shopping_cart.push({pla:changePlatform(i),data:p}),this.payment_collect_qty.push({pla:changePlatform(i),data:u}),o=(100*changeChu(u,c)).toFixed(2),l=changeChu(m,u).toFixed(0),s=changeChu(m,h).toFixed(0),this.pay_conversion_rate.push({pla:changePlatform(i),data:o}),this.customer_price.push({pla:changePlatform(i),data:l}),this.unit_price.push({pla:changePlatform(i),data:s})}this.fillEachart(),this.fillTable()},changeShopName(t,e){var a;return e.forEach((function(e){e.id==t&&(a=e.shop_name)})),a},fillEachart(){var t=this.date_arr,e=this.sel_pla.map((function(t){return changePlatform(t)})),a=["日期"].concat(e),i=[];for(var n in t){var r=t[n];if("week"==this.dateType){var o=n.split("-")[0];n=o+"年第"+getWeekInYear(n)+"周"}if("monthrange"==this.dateType){var l=n.split("-");n=l[0]+"-"+l[1]}l=[n];for(var s in this.sel_pla){var d=this.sel_pla[s],m=0,h=0,c=0,p=0,u=0,_=0;for(var f in r){var y=r[f];d==y.platform&&(m=changeSum(m,y[this.s_tar]),h=changeSum(h,y.payment_amt),c=changeSum(c,y.payment_qty),p=changeSum(p,y.visitors),u=changeSum(u,y.shopping_cart),_=changeSum(_,y.payment_collect_qty))}"pay_conversion_rate"==this.s_tar&&(m=(100*changeChu(_,p)).toFixed(2)),"customer_price"==this.s_tar&&(m=changeChu(h,_).toFixed(0)),"unit_price"==this.s_tar&&(m=changeChu(h,c).toFixed(0)),l.push(m)}i.push(l)}data_all=[a],i.sort((function(t,e){return new Date(t[0]).getTime()-new Date(e[0]).getTime()})),data_all=data_all.concat(i),polygonal("echart_sellTrend",data_all)},fillTable(){var t=this,e=layui.table,a=r("brand",t.pla_data),i=r("category1",t.pla_data),n=r("shop_name",t.pla_data);function r(t,e){var a=[];for(var i in e){var n=e[i],r=changePlatform(i),o={name:r,data:n,pla:r,showZi:!0};a.push(o);var l=[];for(var s in n){var d=n[s][t];""==d&&(d="其它"),0==l.hasOwnProperty(d)&&(l[d]=[]),l[d].push(n[s])}for(var m in l){var h={name:m,data:l[m],parent_pla:r};a.push(h)}}return a}function o(a,i,n){t.title=[{field:"name",title:"",sort:!1,minWidth:170,templet:function(t){var e;if(t.pla){var a="layui-icon-reduce-circle";0==t.showZi&&(a="layui-icon-add-circle"),e='<span lay-event="edit"><i class="layui-icon '+a+' tbtn" onclick="tclick(\''+n+"','"+t.pla+"',$(this))\"></i>"+t.name+"</span>"}else e='<span style="margin-left: 20px;" parent_pla='+t.parent_pla+">"+t.name+"</span>";return e}},{title:"支付金额(元)",sort:!1,minWidth:130,templet:function(t){return payment_amt=l(t,"payment_amt"),l(t,"payment_amt")}},{title:"支付件数(件)",sort:!1,minWidth:130,templet:function(t){return payment_qty=l(t,"payment_qty"),l(t,"payment_qty")}},{title:"访客数(人)",sort:!1,minWidth:130,templet:function(t){return visitors=l(t,"visitors"),l(t,"visitors")}},{title:"加购人数(人)",sort:!1,minWidth:130,templet:function(t){return l(t,"shopping_cart")}},{title:"支付买家数(人)",sort:!1,minWidth:130,templet:function(t){return payment_collect_qty=l(t,"payment_collect_qty"),l(t,"payment_collect_qty")}},{title:"支付转化率(%)",sort:!1,minWidth:130,templet:function(t){return(100*changeChu(payment_collect_qty,visitors)).toFixed(2)}},{title:"客单价(元)",sort:!1,minWidth:130,templet:function(t){return changeChu(payment_amt,payment_collect_qty).toFixed(0)}},{title:"件单价(元)",sort:!1,minWidth:130,templet:function(t){return changeChu(payment_amt,payment_qty).toFixed(0)}}],"table_brand"==n&&(t.title[0].title="品牌/品牌",t.t_name1=[],e.on("tool("+n+")",(function(a){var r=a.data.name,o=t.t_name1.indexOf(r);-1==o?t.t_name1.push(r):t.t_name1.splice(o,1);var l=[],s=i;for(var d in s){var m=s[d];t.t_name1.indexOf(m.pla)>-1&&(m.showZi=!1),-1==t.t_name1.indexOf(m.pla)&&(m.showZi=!0),-1==t.t_name1.indexOf(m.parent_pla)&&l.push(m)}e.reload(n,{data:l})}))),"table_category"==n&&(t.title[0].title="品牌/类目",t.t_name2=[],e.on("tool("+n+")",(function(a){var r=a.data.name,o=t.t_name2.indexOf(r);-1==o?t.t_name2.push(r):t.t_name2.splice(o,1);var l=[],s=i;for(var d in s){var m=s[d];t.t_name2.indexOf(m.pla)>-1&&(m.showZi=!1),-1==t.t_name2.indexOf(m.pla)&&(m.showZi=!0),-1==t.t_name2.indexOf(m.parent_pla)&&l.push(m)}e.reload(n,{data:l})}))),"table_shop"==n&&(t.title[0].title="品牌/店铺",t.t_name3=[],e.on("tool("+n+")",(function(a){var r=a.data.name,o=t.t_name3.indexOf(r);-1==o?t.t_name3.push(r):t.t_name3.splice(o,1);var l=[],s=i;for(var d in s){var m=s[d];t.t_name3.indexOf(m.pla)>-1&&(m.showZi=!1),-1==t.t_name3.indexOf(m.pla)&&(m.showZi=!0),-1==t.t_name3.indexOf(m.parent_pla)&&l.push(m)}e.reload(n,{data:l})}))),e.render({elem:a,id:n,data:i,limit:10,page:!0,cols:[t.title]})}function l(t,e){var a=0;for(var i in t.data){var n=t.data[i][e];a=changeSum(a,n)}return a}o("#table_brand",a,"table_brand"),o("#table_category",i,"table_category"),o("#table_shop",n,"table_shop")}}})}]);