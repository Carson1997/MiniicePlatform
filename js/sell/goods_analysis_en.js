!function(e){var t={};function a(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,a),o.l=!0,o.exports}a.m=e,a.c=t,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(i,o,function(t){return e[t]}.bind(null,o));return i},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t){new Vue({el:"#vue",data:{allGoodsData:{data1:"",data2:""},send:{date:"2020-01-01_2020-06-30",date_type:"1",prd_id:"617087915410",prd_id2:"",prd_id3:""},time_data:{start_time:"",end_time:""},dateValue:"",dateType:"daterange",selectDate:"---",defaultValue:"",dataType:1,pickOption:{firstDayOfWeek:1,disabledDate:function(e){}},pickOptionMonth:{firstDayOfWeek:1,disabledDate:function(e){}},selectDateShow:"2020-01-01_2020-06-30",daterange:[],monthrange:[],dateValue2:"",daterange2:"",monthrange2:"",sel_goods:["617087915410"],payment_amt:[],payment_qty:[],visitors:[],shopping_cart:[],payment_collect_qty:[],pay_conversion_rate:[],customer_price:[],unit_price:[],s_tar:"payment_amt",dateType2:"no",type2:"no"},mounted:function(){this.initLayui(),this.initConTop(),this.initSelect(),this.initHeZiClick(),this.getShop()},methods:{mergeHandle:function(e){this.defaultValue=e.end_time,limitDayBegin=new Date(e.start_time.replace("-","/")).getTime(),limitDayEnd=new Date(e.end_time.replace("-","/")).getTime(),this.pickOption.disabledDate=function(e){if(limitDayBegin>e.getTime()||limitDayEnd<e.getTime())return e};var t=moment(limitDayEnd).endOf("month").format("YYYY-MM-DD"),a=limitDayEnd;if(e.end_time!=t){var i=moment(e.end_time).subtract(1,"months").format("YYYY-MM-DD");a=moment(i).endOf("month").format("YYYY-MM-DD"),a=new Date(a).getTime()}this.pickOptionMonth.disabledDate=function(e){return a>limitDayBegin?limitDayBegin>e.getTime()||a<e.getTime()?e:void 0:e}},selectLis:function(e,t){this.dataType=t;var a=this.time_data;this.dateType!=e?(this.dateValue="",this.dateType=e,this.mergeHandle(a)):this.mergeHandle(a),"daterange"==e&&$("#datePicker1").find(".el-date-editor--daterange")[0].click(),"week"==e&&($("#datePicker1").find(".el-date-editor--daterange")[1].click(),$(".available").removeClass("in-range start-date"),$(".available").removeClass("in-range end-date")),"monthrange"==e&&$("#datePicker1").find(".el-date-editor--monthrange").click()},dateClick:function(e){$(".wordClick").removeClass("wordClick");var t="";if("date"==this.dateType)t=e+"_"+e,$($(".word")[0]).addClass("wordClick");else if("week"==this.dateType){t=(a=moment(e).isoWeekday(1).week(moment(e).isoWeekday(1).week()).startOf("isoweek").format("YYYY-MM-DD"))+"_"+(i=moment(e).isoWeekday(1).week(moment(e).isoWeekday(1).week()).endOf("isoweek").format("YYYY-MM-DD")),$($(".word")[1]).addClass("wordClick")}else if("month"==this.dateType){t=(a=moment(e).month(moment(e).month()).startOf("month").format("YYYY-MM-DD"))+"_"+(i=moment(e).month(moment(e).month()).endOf("month").format("YYYY-MM-DD")),$($(".word")[2]).addClass("wordClick")}if(this.selectDate=t,"week"==this.dateType){this.send.date_type=2;var a=moment(e[0]).isoWeekday(1).week(moment(e[0]).isoWeekday(1).week()).startOf("isoweek").format("YYYY-MM-DD"),i=moment(e[1]).isoWeekday(1).week(moment(e[1]).isoWeekday(1).week()).endOf("isoweek").format("YYYY-MM-DD");this.selectDateShow=a+"_"+i,this.send.date=this.selectDateShow}if("daterange"==this.dateType&&($($(".word")[0]).addClass("wordClick"),this.selectDateShow=e[0]+"_"+e[1],this.send.date=this.selectDateShow,this.send.date_type=1),"monthrange"==this.dateType){$($(".word")[2]).addClass("wordClick");t=(a=moment(e[0]).month(moment(e[0]).month()).startOf("month").format("YYYY-MM-DD"))+"_"+(i=moment(e[1]).month(moment(e[1]).month()).endOf("month").format("YYYY-MM-DD"));this.selectDateShow=e[0].substr(0,7)+"_"+e[1].substr(0,7),this.send.date=t,this.send.date_type=3}this.daterange="",this.dateValue="",this.monthrange="",this.getGoodsData(1)},dateClick2:function(e){if($("#xm-time").val("yes"),layui.form.render(),"week"==this.dateType2){this.send.date_type=2;var t=moment(e[0]).isoWeekday(1).week(moment(e[0]).isoWeekday(1).week()).startOf("isoweek").format("YYYY-MM-DD"),a=moment(e[1]).isoWeekday(1).week(moment(e[1]).isoWeekday(1).week()).endOf("isoweek").format("YYYY-MM-DD");this.selectDateShow=t+"_"+a,this.send.date=this.selectDateShow}if("daterange"==this.dateType2&&(this.selectDateShow2=e[0]+"_"+e[1],this.send.date=this.selectDateShow2,this.send.date_type=1),"monthrange"==this.dateType2){var i=(t=moment(e[0]).month(moment(e[0]).month()).startOf("month").format("YYYY-MM-DD"))+"_"+(a=moment(e[1]).month(moment(e[1]).month()).endOf("month").format("YYYY-MM-DD"));this.selectDateShow2=e[0].substr(0,7)+"_"+e[1].substr(0,7),this.send.date=i,this.send.date_type=3}this.daterange2="",this.dateValue2="",this.monthrange2="",this.getGoodsData(2)},getShop(){var e=this;addLoading(),$.ajax({url:url_shop,type:"get",dataType:"json",timeout:1e4,success:function(t){removeLoading(),checkStatus(t,(function(){t.data.length>0&&(e.time_data.start_time=t.data[0].data_star,e.time_data.end_time=t.data[0].data_end,e.selectDateShow=t.data[0].data_star+"_"+t.data[0].data_end,e.daterange=[t.data[0].data_star,t.data[0].data_end],e.send.date=e.selectDateShow),e.getGoods()}))},error:function(){removeLoading(),layer.alert("请求失败")}})},getGoods(){var e=this;addLoading(),$.ajax({url:url_goods,type:"get",dataType:"json",data:{},timeout:1e4,success:function(t){removeLoading(),checkStatus(t,(function(){var a=t.data;e.fillGoodsSelect(a)}))},error:function(){removeLoading(),layer.alert("请求失败")}})},fillGoodsSelect(e){var t=[],a=[];for(var i in e){e[i];if(-1==t.indexOf(e[i].prd_id)){t.push(e[i].prd_id);var o={name:e[i].model_num,value:e[i].prd_id};a.push(o)}}this.arr_goods=a,this.selectRadio("#xm-goods1",this.arr_goods),this.selectRadio("#xm-goods2",this.arr_goods),this.selectRadio("#xm-goods3",this.arr_goods),this.getGoodsData(1)},getGoodsData(e){var t=this;addLoading(),$.ajax({url:url_shop_analysis,type:"post",dataType:"json",data:t.send,timeout:1e4,success:function(a){removeLoading(),checkStatus(a,(function(){1==e&&(t.allGoodsData.data1=a.data),2==e&&(t.allGoodsData.data2=a.data),t.filterData()}))},error:function(){removeLoading(),layer.alert("请求失败")}})},filterData(){for(var e in this.goods_data=[],this.payment_amt=[],this.payment_qty=[],this.visitors=[],this.shopping_cart=[],this.payment_collect_qty=[],this.pay_conversion_rate=[],this.customer_price=[],this.unit_price=[],this.date_arr=[],this.sel_goods){var t=this.sel_goods[e];t&&(this.goods_data[t]=[])}for(var a in this.allGoodsData){var i=this.allGoodsData[a];for(var o in i){var n=(m=i[o]).statistics_date;0==this.date_arr.hasOwnProperty(n)&&(this.date_arr[n]={data1:[],data2:[]}),this.date_arr[n][a][m.prd_id]=m;var d=m.prd_id;"data1"==a&&this.goods_data[d]&&this.goods_data[d].push(m)}}for(var a in this.goods_data){var s,r,l,m=this.goods_data[a],h=0,c=0,u=0,p=0,f=0;for(var i in m){var _=m[i];h=changeSum(h,_.payment_amt),c=changeSum(c,_.payment_qty),u=changeSum(u,_.visitors),p=changeSum(p,_.shopping_cart),f=changeSum(f,_.payment_collect_qty)}var g=this.sel_goods.indexOf(a);this.payment_amt.push({prd:g,data:h}),this.payment_qty.push({prd:g,data:c}),this.visitors.push({prd:g,data:u}),this.shopping_cart.push({prd:g,data:p}),this.payment_collect_qty.push({prd:g,data:f}),s=(100*changeChu(f,u)).toFixed(2),r=changeChu(h,f).toFixed(0),l=changeChu(h,c).toFixed(0),this.pay_conversion_rate.push({prd:g,data:s}),this.customer_price.push({prd:g,data:r}),this.unit_price.push({prd:g,data:l})}this.fillEachart()},initLayui(){layui.form.render()},initConTop(){var e=$(".fixedTitle").height()+10;$(".layui-fluid").css("margin-top",e)},initSelect(){var e=this,t=layui.form;t.on("select(xm-time)",(function(a){$("#xm-time").val("no"),t.render();var i=a.value;e.mergeHandle(e.time_data),e.type2=i,e.dateType2=e.dateType,"no"==i?(e.allGoodsData.data2="",e.dateValue2="",e.daterange2="",e.monthrange2="",e.filterData()):("daterange"==e.dateType&&$("#datePicker2").find(".el-date-editor--daterange")[0].click(),"week"==e.dateType&&($("#datePicker2").find(".el-date-editor--daterange")[1].click(),$(".available").removeClass("in-range start-date"),$(".available").removeClass("in-range end-date")),"monthrange"==e.dateType&&$("#datePicker2").find(".el-date-editor--monthrange").click())}))},selectRadio(e,t){var a=this,i=xmSelect.render({direction:"down",el:e,size:"mini",radio:!0,toolbar:{show:!0,showIcon:!1,list:["CLEAR"]},filterable:!0,height:400,model:{icon:"hidden",label:{type:"text"}},theme:{color:"#ED6D00"},data:t,on:function(t){if("#xm-goods1"==e){var i=d(t);a.sel_goods[0]=i,a.send.prd_id=i}if("#xm-goods2"==e){var o=d(t);a.sel_goods[1]=o,a.send.prd_id2=o}if("#xm-goods3"==e){var n=d(t);a.sel_goods[2]=n,a.send.prd_id3=n}function d(e){return e.arr.length>0?e.arr[0].value:""}a.getGoodsData(1)}});if("#xm-goods1"==e&&(i.setValue([a.sel_goods[0]]),localStorage.prd_id)){var o=localStorage.prd_id;a.sel_goods[0]=o,a.send.prd_id=o,i.setValue([o]),localStorage.removeItem("prd_id")}},clickTitleIcon(){var e,t,a=$(".titleIcon i").attr("class"),i=$(".fixedTitle").height(),o=$(".layui-fluid").offset().top;-1!=a.indexOf("layui-icon-up")?(this.content_top=o,e=10,t=i,$(".titleIcon i").attr("class","layui-icon layui-icon-down")):($(".titleIcon i").attr("class","layui-icon layui-icon-up"),e=this.content_top,t=0),$(".fixedTitle").animate({"margin-top":"-"+t},".1s"),$(".layui-fluid").animate({"margin-top":e},".1s")},initHeZiClick(){var e=this;$(".myBorderHeZi").click((function(){$(this).siblings().removeClass("selectHezi"),$(this).addClass("selectHezi"),e.s_tar=$(this).attr("data"),e.fillEachart()}))},fillEachart(){var e=this,t=[],a=e.date_arr,i=["日期"];"no"==e.type2?(l=(l=e.sel_goods.map((function(e,t){if(e)return"商品"+(t+1)}))).filter((function(e){return e})),i=i.concat(l)):i=["日期","不对比","对比时间"];var o=[];for(var n in a){var d=a[n];if("week"==e.dateType){var s=n.split("-")[0];n=s+"年第"+getWeekInYear(n)+"周"}if("monthrange"==e.dateType){var r=n.split("-");n=r[0]+"-"+r[1]}r=[n];if("no"==e.dateType2){var l=e.sel_goods.filter((function(e){if(e)return e}));for(var m in l){var h=l[m],c="";for(var u in d.data1)i2=d.data1[u],u==h&&(c=i2[e.s_tar]);r.push(c)}}else{l=e.sel_goods[0];var p="",f="";function _(t,a){if(0==Object.keys(t).length)return a="";var i=0,o=0,n=0,d=0,s=0;for(var r in t){var l=t[r];a=changeSum(a,l[e.s_tar]),i=changeSum(i,l.payment_amt),o=changeSum(o,l.payment_qty),n=changeSum(n,l.visitors),d=changeSum(d,l.shopping_cart),s=changeSum(s,l.payment_collect_qty)}return"pay_conversion_rate"==e.s_tar&&(a=(100*changeChu(s,n)).toFixed(2)),"customer_price"==e.s_tar&&(a=changeChu(i,s).toFixed(0)),"unit_price"==e.s_tar&&(a=changeChu(i,o).toFixed(0)),a}p=_(d.data1,p),f=_(d.data2,f),r.push(p),r.push(f)}o.push(r)}t=[i],o.sort((function(e,t){return new Date(e[0]).getTime()-new Date(t[0]).getTime()})),t=t.concat(o),polygonal("echart_sellTrend",t)}}})}]);