!function(t){var e={};function a(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=e,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(i,n,function(e){return t[e]}.bind(null,n));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=0)}([function(t,e,a){t.exports=a(1)},function(t,e){new Vue({el:"#vue",data:{allShopData:{data1:"",data2:""},send:{date:"2020-06-01_2020-06-30",date_type:"1"},time_data:{start_time:"",end_time:""},dateValue:"",dateType:"daterange",selectDate:"---",defaultValue:"",dataType:1,pickOption:{firstDayOfWeek:1,disabledDate:function(t){}},pickOptionMonth:{firstDayOfWeek:1,disabledDate:function(t){}},selectDateShow:"",daterange:[],monthrange:[],dateValue2:"",daterange2:"",monthrange2:"",select_shop:[],monthSale:[],yearSale:[],monthTargetName:"",yearTargetName:"",target:{},target_month:{payamt:"",target:[{targetname:"",target:""}]},target_year:{payamt:"",target:[{targetname:"",target:""}]},payment_amt:0,payment_qty:0,visitors:0,shopping_cart:0,payment_collect_qty:0,pay_conversion_rate:0,customer_price:0,unit_price:0,s_tar:"payment_amt",dateType2:"no",type2:"no",tarShow:""},mounted:function(){this.initLayui(),this.initSelect(),this.initConTop(),this.getShop(),this.initHeZiClick()},methods:{mergeHandle:function(t){this.defaultValue=t.end_time,limitDayBegin=new Date(t.start_time.replace("-","/")).getTime(),limitDayEnd=new Date(t.end_time.replace("-","/")).getTime(),this.pickOption.disabledDate=function(t){if(limitDayBegin>t.getTime()||limitDayEnd<t.getTime())return t};var e=moment(limitDayEnd).endOf("month").format("YYYY-MM-DD"),a=limitDayEnd;if(t.end_time!=e){var i=moment(t.end_time).subtract(1,"months").format("YYYY-MM-DD");a=moment(i).endOf("month").format("YYYY-MM-DD"),a=new Date(a).getTime()}this.pickOptionMonth.disabledDate=function(t){return a>limitDayBegin?limitDayBegin>t.getTime()||a<t.getTime()?t:void 0:t}},selectLis:function(t,e){this.dataType=e;var a=this.time_data;this.dateType!=t?(this.dateValue="",this.dateType=t,this.mergeHandle(a)):this.mergeHandle(a),"daterange"==t&&$("#datePicker1").find(".el-date-editor--daterange")[0].click(),"week"==t&&($("#datePicker1").find(".el-date-editor--daterange")[1].click(),$(".available").removeClass("in-range start-date"),$(".available").removeClass("in-range end-date")),"monthrange"==t&&$("#datePicker1").find(".el-date-editor--monthrange").click()},dateClick:function(t){$(".wordClick").removeClass("wordClick");var e="";if("date"==this.dateType)e=t+"_"+t,$($(".word")[0]).addClass("wordClick");else if("week"==this.dateType){e=(a=moment(t).isoWeekday(1).week(moment(t).isoWeekday(1).week()).startOf("isoweek").format("YYYY-MM-DD"))+"_"+(i=moment(t).isoWeekday(1).week(moment(t).isoWeekday(1).week()).endOf("isoweek").format("YYYY-MM-DD")),$($(".word")[1]).addClass("wordClick")}else if("month"==this.dateType){e=(a=moment(t).month(moment(t).month()).startOf("month").format("YYYY-MM-DD"))+"_"+(i=moment(t).month(moment(t).month()).endOf("month").format("YYYY-MM-DD")),$($(".word")[2]).addClass("wordClick")}if(this.selectDate=e,"week"==this.dateType){this.send.date_type=2;var a=moment(t[0]).isoWeekday(1).week(moment(t[0]).isoWeekday(1).week()).startOf("isoweek").format("YYYY-MM-DD"),i=moment(t[1]).isoWeekday(1).week(moment(t[1]).isoWeekday(1).week()).endOf("isoweek").format("YYYY-MM-DD");this.selectDateShow=a+"_"+i,this.send.date=this.selectDateShow}if("daterange"==this.dateType&&($($(".word")[0]).addClass("wordClick"),this.selectDateShow=t[0]+"_"+t[1],this.send.date=this.selectDateShow,this.send.date_type=1),"monthrange"==this.dateType){$($(".word")[2]).addClass("wordClick");e=(a=moment(t[0]).month(moment(t[0]).month()).startOf("month").format("YYYY-MM-DD"))+"_"+(i=moment(t[1]).month(moment(t[1]).month()).endOf("month").format("YYYY-MM-DD"));this.selectDateShow=t[0].substr(0,7)+"_"+t[1].substr(0,7),this.send.date=e,this.send.date_type=3}this.daterange="",this.dateValue="",this.monthrange="",this.getMonTarDate(),this.getShopData(1)},getMonTarDate(){var t=this.send.date.split("_")[0];this.montar_date1=moment(t).month(moment(t).month()).startOf("month").format("YYYY-MM-DD"),this.montar_date2=moment(t).month(moment(t).month()).endOf("month").format("YYYY-MM-DD"),1!=this.send.date_type&&3!=this.send.date_type||(this.selectDateShow.split("_")[0]==this.selectDateShow.split("_")[1]?this.tarShow=!0:this.tarShow=!1),2==this.send.date_type&&(this.tarShow=!1)},dateClick2:function(t){if($("#xm-time").val("yes"),layui.form.render(),"week"==this.dateType2){this.send.date_type=2;var e=moment(t[0]).isoWeekday(1).week(moment(t[0]).isoWeekday(1).week()).startOf("isoweek").format("YYYY-MM-DD"),a=moment(t[1]).isoWeekday(1).week(moment(t[1]).isoWeekday(1).week()).endOf("isoweek").format("YYYY-MM-DD");this.selectDateShow2=e+"_"+a,this.send.date=this.selectDateShow2}if("daterange"==this.dateType2&&(this.selectDateShow2=t[0]+"_"+t[1],this.send.date=this.selectDateShow2,this.send.date_type=1),"monthrange"==this.dateType2){var i=(e=moment(t[0]).month(moment(t[0]).month()).startOf("month").format("YYYY-MM-DD"))+"_"+(a=moment(t[1]).month(moment(t[1]).month()).endOf("month").format("YYYY-MM-DD"));this.selectDateShow2=t[0].substr(0,7)+"_"+t[1].substr(0,7),this.send.date=i,this.send.date_type=3}this.daterange2="",this.dateValue2="",this.monthrange2="",this.getShopData(2)},initLayui(){var t=this,e=layui.form;e.render(),e.on("checkbox(dx)",(function(e){var a=e.value,i=!e.elem.checked;t.title[a].hide=i,layui.table.reload("table_shop",{cols:[t.title]})}))},initConTop(){var t=$(".fixedTitle").height()+10;$(".layui-fluid").css("margin-top",t)},initSelect(){var t=this,e=layui.form;e.on("select(xm-time)",(function(a){$("#xm-time").val("no"),e.render();var i=a.value;t.mergeHandle(t.time_data),t.dateType2=t.dateType,t.type2=i,"no"==i?(t.allShopData.data2="",t.dateValue2="",t.daterange2="",t.monthrange2="",t.filterData()):("daterange"==t.dateType&&$("#datePicker2").find(".el-date-editor--daterange")[0].click(),"week"==t.dateType&&($("#datePicker2").find(".el-date-editor--daterange")[1].click(),$(".available").removeClass("in-range start-date"),$(".available").removeClass("in-range end-date")),"monthrange"==t.dateType&&$("#datePicker2").find(".el-date-editor--monthrange").click())}))},clickTitleIcon(){var t,e,a=$(".titleIcon i").attr("class"),i=$(".fixedTitle").height(),n=$(".layui-fluid").offset().top;-1!=a.indexOf("layui-icon-up")?(this.content_top=n,t=10,e=i,$(".titleIcon i").attr("class","layui-icon layui-icon-down")):($(".titleIcon i").attr("class","layui-icon layui-icon-up"),t=this.content_top,e=0),$(".fixedTitle").animate({"margin-top":"-"+e},".1s"),$(".layui-fluid").animate({"margin-top":t},".1s")},initHeZiClick(){var t=this;$(".myBorderHeZi").click((function(){$(this).siblings().removeClass("selectHezi"),$(this).addClass("selectHezi"),t.s_tar=$(this).attr("data"),t.fillEachart()}))},yearMonthTarget:function(t,e){for(var a=this,i=[],n="NaN"==parseInt(t.payamt).toString()?"---":parseInt(t.payamt),r=0;r<t.target.length;r++)if(0!=t.target[r].target){var o={target:roundingFormat(t.target[r].target),payamt:roundingFormat(n),targetName:t.target[r].targetname};i.push(o)}if(0==i.length){o={target:0,payamt:roundingFormat(n),targetName:"未设置目标"};i.push(o)}this[e+"Sale"]=i.slice(0),this[e+"TargetName"]=i[0].targetName,Vue.nextTick((function(){for(var t=0;t<i.length;t++){var n="target-"+e+"-charts_"+t,r="NaN"==(parseFloat(i[t].payamt)/parseFloat(i[t].target)*100).toFixed(2).toString()?0:(parseFloat(i[t].payamt)/parseFloat(i[t].target)*100).toFixed(2);dashBoard(n,"销量完成率",r)}"month"==e&&i.length>1?a.target_swicth(i.length,"#c-data-month",e):"year"==e&&i.length>1&&a.target_swicth(i.length,"#c-data-year",e)}))},target_swicth:function(t,e,a){var i=this;$(e).find(".switch-box").empty();for(var n="",r=0;r<t;r++)n+='<span class="switch-btn" data-index="'+r+'" ',0==r&&(n+='data-check="true" style="background:rgba(0, 0, 0, 0.5)" '),n+="></span>";$(e).find(".switch-box").append(n),$(e).find(".switch-btn").unbind("click").bind("click",(function(t){$(e).find(".switch-btn").removeAttr("style"),$(e).find(".switch-btn").removeAttr("data-check"),$(t.currentTarget).css("background","rgba(0,0,0,0.5)"),$(t.currentTarget).attr("data-check","true");var n=$(t.currentTarget).parent().prev().width();$(e).find(".c-p-switch-box").css("right",n*$(t.currentTarget).attr("data-index"));var r=a+"Sale";i[a+"TargetName"]=i[r][$(t.currentTarget).attr("data-index")].targetName})),$(window).resize((function(){var t=$(e).find(".c-p-switch-box").width(),a=$(e).find('.switch-btn[data-check="true"]').attr("data-index");"0"!=$(e).find('.switch-btn[data-check="true"]').attr("data-index")&&$(e).find(".c-p-switch-box").css("right",t*a)}))},getShop(){var t=this;addLoading(),$.ajax({url:url_shop,type:"get",dataType:"json",timeout:1e4,success:function(e){removeLoading(),checkStatus(e,(function(){var a=e.data;t.fillShopSelect(a)}))},error:function(){removeLoading(),layer.alert("请求失败")}})},fillShopSelect(t){var e=this;for(var a in t){var i=t[a];t[a].name=t[a].shop_name+"("+changePlatform(i.platform)+")",t[a].value=t[a].id}var n=xmSelect.render({direction:"down",el:"#xm-shop",size:"mini",height:"auto",toolbar:{show:!0,showIcon:!1,list:["CLEAR"]},filterable:!0,model:{label:{type:"text"}},theme:{color:"#ED6D00"},data:t,on:function(t){t.arr.length>0?e.select_shop=t.arr.map((function(t){return{shop_id:t.id,shop_name:t.name,data:[]}})):e.select_shop=[],e.filterData()}});t.length>0&&(e.time_data.start_time=t[0].data_star,e.time_data.end_time=t[0].data_end,e.selectDateShow=t[0].data_end+"_"+t[0].data_end,e.daterange=[t[0].data_star,t[0].data_end],e.send.date=e.selectDateShow,n.setValue([t[0].id]),e.select_shop=[{shop_id:t[0].id,shop_name:t[0].shop_name+changePlatform(t[0].platform),data:[]}]),e.getMonTarDate(),e.getShopData(1)},getShopData(t){var e=this;addLoading(),$.ajax({url:url_shop_select,type:"post",dataType:"json",data:e.send,timeout:1e4,success:function(a){removeLoading(),checkStatus(a,(function(){1==t&&(e.allShopData.data1=a.data.shop_data),2==t&&(e.allShopData.data2=a.data.shop_data),e.target.target_year=a.data.target_year,e.target.shop_target=a.data.shop_target,e.target.shop_data=a.data.shop_data,e.filterData()}))},error:function(){removeLoading(),layer.alert("请求失败")}})},filterTimeData(t,e){var a=new Date(t.split("_")[0]).getTime(),i=new Date(t.split("_")[1]).getTime();if(e.length>0)return e.filter((function(t){var e=new Date(t.statistics_date).getTime();if(e>=a&&e<=i)return t}))},filterData(){var t=this.allShopData;for(var e in this.date_arr=[],this.target_month.payamt=0,this.target_month.target[0].target=0,this.target_year.payamt=0,this.target_year.target[0].target=0,this.select_shop){var a=this.select_shop[e];if(a.data=[],this.tarShow){for(var i in this.target.shop_target){var n=this.target.shop_target[i];a.shop_id==n.shop_id&&(this.montar_date1==n.date&&(this.target_month.target[0].target=n.target),this.target_year.target[0].target=changeSum(this.target_year.target[0].target,n.target))}for(var i in this.target.shop_data){var r=(n=this.target.shop_data[i]).statistics_date,o=n.shop_id;this.montar_date1<=r&&r<=this.montar_date2&&a.shop_id==o&&(this.target_month.payamt=changeSum(this.target_month.payamt,n.payment_amt))}for(var i in this.target.target_year){n=this.target.target_year[i];a.shop_id==n.shop_id&&(this.target_year.payamt=changeSum(this.target_year.payamt,n.payment_amt))}}for(var i in t){var s=t[i];for(var h in s){n=s[h];if(a.shop_id==n.shop_id){r=n.statistics_date;0==this.date_arr.hasOwnProperty(r)&&(this.date_arr[r]={data1:[],data2:[]}),"data1"==i&&a.data.push(n),this.date_arr[r][i].push(n)}}}}this.tarShow&&(this.yearMonthTarget(this.target_month,"month"),this.yearMonthTarget(this.target_year,"year")),this.fillHeZi(),this.fillEachart(),this.fillTable()},fillHeZi(){var t=this.select_shop;for(var e in this.payment_amt=0,this.payment_qty=0,this.visitors=0,this.shopping_cart=0,this.payment_collect_qty=0,this.pay_conversion_rate=0,this.customer_price=0,this.unit_price=0,t){var a=t[e].data;for(var e in a){var i=a[e];this.payment_amt=changeSum(this.payment_amt,i.payment_amt),this.payment_qty=changeSum(this.payment_qty,i.payment_qty),this.visitors=changeSum(this.visitors,i.visitors),this.shopping_cart=changeSum(this.shopping_cart,i.shopping_cart),this.payment_collect_qty=changeSum(this.payment_collect_qty,i.payment_collect_qty)}}this.pay_conversion_rate=(100*changeChu(this.payment_collect_qty,this.visitors)).toFixed(2),this.customer_price=changeChu(this.payment_amt,this.payment_collect_qty).toFixed(0),this.unit_price=changeChu(this.payment_amt,this.payment_qty).toFixed(0)},fillEachart(){var t=this,e=[],a=t.date_arr,i=["日期","不对比"];"no"!=t.type2&&(i[2]="对比时间");var n=[];for(var r in a){var o=a[r],s="",h="";function d(e,a){if(0==e.length)return a="";var i=0,n=0,r=0,o=0,s=0;for(var h in e){var d=e[h];a=changeSum(a,d[t.s_tar]),i=changeSum(i,d.payment_amt),n=changeSum(n,d.payment_qty),r=changeSum(r,d.visitors),o=changeSum(o,d.shopping_cart),s=changeSum(s,d.payment_collect_qty)}return"pay_conversion_rate"==t.s_tar&&(a=(100*changeChu(s,r)).toFixed(2)),"customer_price"==t.s_tar&&(a=changeChu(i,s).toFixed(0)),"unit_price"==t.s_tar&&(a=changeChu(i,n).toFixed(0)),a}if(s=d(o.data1,s),h=d(o.data2,h),"week"==t.dateType){var m=r.split("-")[0];r=m+"年第"+getWeekInYear(r)+"周"}if("monthrange"==t.dateType){var l=r.split("-");r=l[0]+"-"+l[1]}l=[r,s];"no"!=t.dateType2&&l.push(h),n.push(l)}e=(e=[i]).concat(n),n.sort((function(t,e){return new Date(t[0]).getTime()-new Date(e[0]).getTime()})),polygonal("echart_sellTrend",e)},fillTable(){var t,e,a,i,n=layui.table;function r(t,e){var a=0;for(var i in t.data){var n=t.data[i][e];a=changeSum(a,n)}return a}this.title=[{field:"shop_name",title:"店铺",sort:!1,minWidth:195},{title:"支付金额(元)",sort:!1,minWidth:130,templet:function(e){return t=r(e,"payment_amt"),r(e,"payment_amt")}},{title:"支付件数(件)",sort:!1,minWidth:130,templet:function(t){return i=r(t,"payment_qty"),r(t,"payment_qty")}},{title:"访客数(人)",sort:!1,minWidth:130,templet:function(t){return a=r(t,"visitors"),r(t,"visitors")}},{title:"加购人数(人)",sort:!1,minWidth:130,templet:function(t){return r(t,"shopping_cart")}},{title:"支付买家数(人)",sort:!1,minWidth:130,templet:function(t){return e=r(t,"payment_collect_qty"),r(t,"payment_collect_qty")}},{title:"支付转化率(%)",sort:!1,minWidth:130,templet:function(t){return(100*changeChu(e,a)).toFixed(2)}},{title:"客单价(元)",sort:!1,minWidth:130,templet:function(a){return changeChu(t,e).toFixed(0)}},{title:"件单价(元)",sort:!1,minWidth:130,templet:function(e){return changeChu(t,i).toFixed(0)}}],n.render({id:"table_shop",elem:"#table_shop",data:this.select_shop,cols:[this.title],limit:10,page:!0})}}})}]);