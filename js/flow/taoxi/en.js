!function(e){var t={};function a(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,a),o.l=!0,o.exports}a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(r,o,function(t){return e[t]}.bind(null,o));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t){var a=new Vue({el:"#vue",data:{send:{date:"2020-01-01_2020-06-30",date_type:"1"},time_data:{start_time:"",end_time:""},dateValue:"",dateType:"daterange",selectDate:"---",defaultValue:"",dataType:1,pickOption:{firstDayOfWeek:1,disabledDate:function(e){}},pickOptionMonth:{firstDayOfWeek:1,disabledDate:function(e){}},selectDateShow:"2020-01-01_2020-06-30",daterange:[],monthrange:[],tap:1,xm_shop:!0,xm_category:!1,xm_brand:!1,xm_goods1:!1,xm_goods2:!1,xm_goods3:!1,sel_goods:[],sel_goods3:[],sel_eq:"全部",sel_shop:"",sel_flowTrend1:"payment_amt",sel_xm1:"",sel_xm2:"全部",sel_xm3:"全部",sel_xm4:"payment_amt",eq_arr:[{name:"全部",value:"全部",selected:!0},{name:"PC",value:"1"},{name:"无线",value:"2"}],xm_arr1:[{name:"支付金额",value:"payment_amt",selected:!0},{name:"访客数",value:"visitors"},{name:"加购人数",value:"shopping_cart_qty"},{name:"支付买家数",value:"payment_buyers_qty"},{name:"支付转化率",value:"pay_conversion_rate"},{name:"客单价",value:"customer_price"}],xm_arr2:[{name:"全部",value:"全部",selected:!0},{name:"淘内免费",value:"淘内免费"},{name:"付费流量",value:"付费流量"},{name:"自主访问",value:"自主访问"},{name:"淘外网站",value:"淘外网站"},{name:"其他来源",value:"其他来源"},{name:"淘外APP",value:"淘外APP"}],xm_arr3:[{name:"全部",value:"全部",selected:!0},{name:"直通车",value:"直通车"},{name:"超级推荐",value:"超级推荐"},{name:"智钻",value:"智钻"},{name:"淘宝客",value:"淘宝客"},{name:"聚划算",value:"聚划算"}]},mounted:function(){this.initLayui(),this.initConTop(),this.initSelect(),this.getShop()},methods:{mergeHandle:function(e){this.defaultValue=e.end_time,limitDayBegin=new Date(e.start_time.replace("-","/")).getTime(),limitDayEnd=new Date(e.end_time.replace("-","/")).getTime(),this.pickOption.disabledDate=function(e){if(limitDayBegin>e.getTime()||limitDayEnd<e.getTime())return e};var t=moment(limitDayEnd).endOf("month").format("YYYY-MM-DD"),a=limitDayEnd;if(e.end_time!=t){var r=moment(e.end_time).subtract(1,"months").format("YYYY-MM-DD");a=moment(r).endOf("month").format("YYYY-MM-DD"),a=new Date(a).getTime()}this.pickOptionMonth.disabledDate=function(e){return a>limitDayBegin?limitDayBegin>e.getTime()||a<e.getTime()?e:void 0:e}},selectLis:function(e,t){this.dataType=t;var a=this.time_data;this.dateType!=e?(this.dateValue="",this.dateType=e,this.mergeHandle(a)):this.mergeHandle(a),"daterange"==e&&$("#datePicker1").find(".el-date-editor--daterange")[0].click(),"week"==e&&($("#datePicker1").find(".el-date-editor--daterange")[1].click(),$(".available").removeClass("in-range start-date"),$(".available").removeClass("in-range end-date")),"monthrange"==e&&$("#datePicker1").find(".el-date-editor--monthrange").click()},dateClick:function(e){$(".wordClick").removeClass("wordClick");var t="";if("date"==this.dateType)t=e+"_"+e,$($(".word")[0]).addClass("wordClick");else if("week"==this.dateType){t=(a=moment(e).isoWeekday(1).week(moment(e).isoWeekday(1).week()).startOf("isoweek").format("YYYY-MM-DD"))+"_"+(o=moment(e).isoWeekday(1).week(moment(e).isoWeekday(1).week()).endOf("isoweek").format("YYYY-MM-DD")),$($(".word")[1]).addClass("wordClick")}else if("month"==this.dateType){t=(a=moment(e).month(moment(e).month()).startOf("month").format("YYYY-MM-DD"))+"_"+(o=moment(e).month(moment(e).month()).endOf("month").format("YYYY-MM-DD")),$($(".word")[2]).addClass("wordClick")}if(this.selectDate=t,"week"==this.dateType){this.send.date_type=2,this.send.date_type=2;var a=moment(e[0]).isoWeekday(1).week(moment(e[0]).isoWeekday(1).week()).startOf("isoweek").format("YYYY-MM-DD"),o=moment(e[1]).isoWeekday(1).week(moment(e[1]).isoWeekday(1).week()).endOf("isoweek").format("YYYY-MM-DD");this.selectDateShow=a+"_"+o,this.send.date=this.selectDateShow}if("daterange"==this.dateType&&($($(".word")[0]).addClass("wordClick"),this.selectDateShow=e[0]+"_"+e[1],this.send.date=this.selectDateShow,this.send.date_type=1),"monthrange"==this.dateType){$($(".word")[2]).addClass("wordClick");t=(a=moment(e[0]).month(moment(e[0]).month()).startOf("month").format("YYYY-MM-DD"))+"_"+(o=moment(e[1]).month(moment(e[1]).month()).endOf("month").format("YYYY-MM-DD"));this.selectDateShow=e[0].substr(0,7)+"_"+e[1].substr(0,7),this.send.date=t,this.send.date_type=3}this.daterange="",this.dateValue="",this.monthrange="",1==this.tap&&this.getShopSource(),2==this.tap&&r(),3==this.tap&&s()},initLayui(){var e=this,t=layui.form;t.render(),function(a,r){t.on(a,(function(t){var a=t.value,o=!t.elem.checked;e.title1[a].hide=o,layui.table.reload(r,{cols:[e.title1]})}))}("checkbox(dx1)","table_source_detail")},initConTop(){var e=$(".fixedTitle").height()+10;$(".layui-fluid").css("margin-top",e)},initSelect(){this.selectRadio("#xm-1flowTrend",this.xm_arr1),this.selectRadio("#xm-eq",this.eq_arr),this.selectRadio("#xm-select2",this.xm_arr2),this.selectRadio("#xm-select3",this.xm_arr3),this.selectRadio("#xm-select4",this.xm_arr1)},selectRadio(e,t){var a=this;xmSelect.render({direction:"down",el:e,size:"mini",radio:!0,toolbar:{show:!0,showIcon:!1,list:["CLEAR"]},filterable:!0,height:400,model:{icon:"hidden",label:{type:"text"}},theme:{color:"#ED6D00"},data:t,on:function(t){"#xm-eq"==e&&(a.sel_eq=r(t),1==a.tap&&a.filterData1(),2==a.tap&&o(),3==a.tap&&filterData3()),"#xm-shop"==e&&(a.sel_shop=r(t),1==a.tap&&a.filterData1(),2==a.tap&&o()),"#xm-1flowTrend"==e&&(a.sel_flowTrend1=r(t),a.fillsel_flowTrend1()),"#xm-select1"==e&&(a.sel_xm1=r(t),a.detailFlowTrend()),"#xm-select2"==e&&(a.sel_xm2=r(t),a.detailFlowTrend()),"#xm-select3"==e&&(a.sel_xm3=r(t),a.detailFlowTrend()),"#xm-select4"==e&&(a.sel_xm4=r(t),a.detailFlowTrend())}});function r(e){return e.arr.length>0?e.arr[0].value:""}},selectMore(e,t){xmSelect.render({direction:"down",el:e,size:"mini",height:"auto",toolbar:{show:!0,showIcon:!1,list:["CLEAR"]},filterable:!0,model:{label:{type:"text"}},theme:{color:"#ED6D00"},data:t,on:function(e){}})},clickTitleIcon(){var e,t,a=$(".titleIcon i").attr("class"),r=$(".fixedTitle").height(),o=$(".layui-fluid").offset().top;-1!=a.indexOf("layui-icon-up")?(this.content_top=o,e=10,t=r,$(".titleIcon i").attr("class","layui-icon layui-icon-down")):($(".titleIcon i").attr("class","layui-icon layui-icon-up"),e=this.content_top,t=0),$(".fixedTitle").animate({"margin-top":"-"+t},".1s"),$(".layui-fluid").animate({"margin-top":e},".1s")},changeTap(e){var t=this;e!=this.tap&&(1==e&&(t.tap=1,t.xm_shop=!0,t.xm_category=!1,t.xm_brand=!1,t.xm_goods1=!1,t.xm_goods2=!1,t.xm_goods3=!1,t.getShopSource()),2==e&&(t.tap=2,t.xm_shop=!0,t.xm_category=!0,t.xm_brand=!0,t.xm_goods1=!1,t.xm_goods2=!1,t.xm_goods3=!1,r()),3==e&&(t.tap=3,t.xm_shop=!1,t.xm_category=!1,t.xm_brand=!1,t.xm_goods1=!0,t.xm_goods2=!0,t.xm_goods3=!0,addLoading(),$.ajax({url:url_goods,type:"post",data:{key:"淘宝"},timeout:1e4,dataType:"json",success:function(e){removeLoading(),checkStatus(e,(function(){arr_goods=e.data,function(e){var t=[],a=[];for(var r in e)if(e[r],-1==t.indexOf(e[r].prd_id)){t.push(e[r].prd_id);var o={name:e[r].model_num,value:e[r].prd_id};a.push(o)}this.arr_goods=a,m("#xm-goods1",this.arr_goods),m("#xm-goods2",this.arr_goods),m("#xm-goods3",this.arr_goods)}(arr_goods)}))},error:function(){removeLoading(),layer.alert("请求失败")}}),s()),setTimeout((function(){t.initConTop()}),50))},getShop(){var e=this;addLoading(),$.ajax({url:url_shop,type:"get",dataType:"json",timeout:1e4,success:function(t){removeLoading(),checkStatus(t,(function(){e.allShopNameData=t.data,e.fillShopSelect(t.data),t.data.length>0&&(e.time_data.start_time=t.data[0].data_star,e.time_data.end_time=t.data[0].data_end,e.selectDateShow=t.data[0].data_star+"_"+t.data[0].data_end,e.daterange=[t.data[0].data_star,t.data[0].data_end],e.send.date=e.selectDateShow),e.getShopSource()}))},error:function(){removeLoading(),layer.alert("请求失败")}})},fillShopSelect(e){for(var t in this.arr_shop=[],e){var a=e[t];1==a.platform&&(e[t].name=e[t].shop_name+"("+changePlatform(a.platform)+")",e[t].value=e[t].id,this.arr_shop.push(e[t]))}this.selectRadio("#xm-shop",this.arr_shop),this.arr_shop.length>0&&(this.sel_shop=this.arr_shop[0].id,xmSelect.get("#xm-shop")[0].setValue([this.sel_shop])),this.selectRadio("#xm-select1",this.arr_shop)},getShopSource(){var e=this;addLoading(),$.ajax({url:url_taoxi_shop_source,data:e.send,type:"post",dataType:"json",timeout:1e4,success:function(t){removeLoading(),checkStatus(t,(function(){e.allShopSourceData=t.data,e.filterData1()}))},error:function(){removeLoading(),layer.alert("请求失败")}})},filterData1(){this.date_arr=[],this.sel_flowTrend1_arr=[],this.flow_data=[];var e=this.allShopSourceData;for(var t in e=this.filterThis(this.sel_eq,e,"terminal"),e=this.filterThis(this.sel_shop,e,"shop_id")){var a=e[t];a.shop_name=changeShopName(a.shop_id,this.allShopNameData);var r=a.statistics_date;0==this.date_arr.hasOwnProperty(r)&&(this.date_arr[r]=[]),this.date_arr[r].push(a),-1==this.sel_flowTrend1_arr.indexOf(a.traffic_source)&&(this.sel_flowTrend1_arr.push(a.traffic_source),this.flow_data[a.traffic_source]=[]),this.flow_data[a.traffic_source].push(a)}this.shopSource()},filterThis(e,t,a){if(!t)return[];var r=t;if(e.length>0&&(r=t.filter((function(t){if(e.indexOf(t[a])>-1&&""!=t[a])return t}))),"全部"==e&&(r=t),"other1"==e){var o=["淘内免费","付费流量","自主访问","淘外流量","其它","淘外网站","其它来源","淘外APP"];r=t.filter((function(e){if(-1==o.indexOf(e[a]))return e}))}if("other2"==e){o=["直通车","超级推荐","智钻","淘宝客","聚划算"];r=t.filter((function(e){if(-1==o.indexOf(e[a]))return e}))}return r},shopSource(){this.fillsel_flowTrend1(),this.detailFlowTrend(),this.tableSourceDetail()},fillsel_flowTrend1(){var e=[["日期"].concat(this.sel_flowTrend1_arr)],t=this.changeEarchData(this.sel_flowTrend1_arr,this.date_arr,"traffic_source",this.sel_flowTrend1);e=e.concat(t),polygonal("echart_1flowTrend",e,!0)},detailFlowTrend(){var e=this,t=e.allShopSourceData;t=e.filterThis(e.sel_eq,t,"terminal");var a=[e.sel_shop];e.sel_xm1&&a.push(e.sel_xm1),t=e.filterThis(a,t,"shop_id"),t=e.filterThis(e.sel_xm2,t,"traffic_source"),t=e.filterThis(e.sel_xm3,t,"source_details"),e.shop_data1=[];var r=[];for(var o in t){var i=t[o];i.shop_name=changeShopName(i.shop_id,e.allShopNameData);var n=i.statistics_date;0==r.hasOwnProperty(n)&&(r[n]=[]),r[n].push(i)}var s=e.changeEarchData(a,r,"shop_id",e.sel_xm4);a=a.map((function(t){return changeShopName(t,e.allShopNameData)}));var l=[["日期"].concat(a)];l=l.concat(s),polygonal("echart_2flowTrend",l)},changeEarchData(e,t,a,r){var o=[];for(var i in t){var n=t[i];if("week"==this.dateType){var s=i.split("-")[0];i=s+"年第"+getWeekInYear(i)+"周"}if("monthrange"==this.dateType){var l=i.split("-");i=l[0]+"-"+l[1]}l=[i];for(var d in e){var c=e[d],m=0,_=0,h=0,u=0,p=0,f=0;for(var g in n){var y=n[g];c==y[a]&&(m=changeSum(m,y[r]),_=changeSum(_,y.payment_amt),h=changeSum(h,y.payment_qty),u=changeSum(u,y.visitors),p=changeSum(p,y.shopping_cart_qty),f=changeSum(f,y.payment_buyers_qty))}"pay_conversion_rate"==r&&(m=(100*changeChu(f,u)).toFixed(2)),"customer_price"==r&&(m=changeChu(_,f).toFixed(0)),"unit_price"==r&&(m=changeChu(_,h).toFixed(0)),l.push(m)}o.push(l)}return o.sort((function(e,t){return new Date(e[0]).getTime()-new Date(t[0]).getTime()})),o},tableSourceDetail(){var e=this,t=layui.table,a=e.g1("source_details",e.flow_data),r=0,o=0,i=0;e.title1=[{field:"name",title:"来源",sort:!1,minWidth:170,templet:function(e){var t;if(e.pla){var a="layui-icon-reduce-circle";0==e.showZi&&(a="layui-icon-add-circle"),t='<span lay-event="edit"><i class="layui-icon '+a+' tbtn"></i>'+e.name+"</span>"}else t='<span style="margin-left: 20px;" parent_pla='+e.parent_pla+">"+e.name+"</span>";return t}},{title:"支付金额(元)",sort:!1,minWidth:130,templet:function(t){return r=e.ts(t,"payment_amt"),e.ts(t,"payment_amt")}},{title:"访客数(人)",sort:!1,minWidth:130,templet:function(t){return o=e.ts(t,"visitors"),e.ts(t,"visitors")}},{title:"加购人数(人)",sort:!1,minWidth:130,templet:function(t){return e.ts(t,"shopping_cart_qty")}},{title:"支付买家数(人)",sort:!1,minWidth:130,templet:function(t){return i=e.ts(t,"payment_buyers_qty"),e.ts(t,"payment_buyers_qty")}},{title:"支付转化率(%)",sort:!1,minWidth:130,templet:function(e){return(100*changeChu(i,o)).toFixed(2)}},{title:"客单价(元)",sort:!1,minWidth:130,templet:function(e){return changeChu(r,i).toFixed(0)}}],t.render({elem:"#table_source_detail",id:"table_source_detail",data:a,limit:10,page:!0,cols:[e.title1]}),e.t_name=[],t.on("tool(table_source_detail)",(function(r){var o=r.data.name,i=e.t_name.indexOf(o);-1==i?e.t_name.push(o):e.t_name.splice(i,1);var n=[];for(var s in a){var l=a[s];e.t_name.indexOf(l.pla)>-1&&(l.showZi=!1),-1==e.t_name.indexOf(l.pla)&&(l.showZi=!0),-1==e.t_name.indexOf(l.parent_pla)&&n.push(l)}t.reload("table_source_detail",{data:n})}))},g1(e,t){var a=[];for(var r in t){var o=t[r],i=r;""==i&&(i="其他");var n={name:i,data:o,pla:i,showZi:!0};a.push(n);var s=[];for(var l in o){var d=o[l][e];0==s.hasOwnProperty(d)&&(s[d]=[]),s[d].push(o[l])}for(var c in s){var m=s[c];""==c&&(c="其他");var _={name:c,data:m,parent_pla:i};a.push(_)}}return a},ts(e,t){var a=0;for(var r in e.data){var o=e.data[r][t];a=changeSum(a,o)}return a}}});function r(){var e=a;addLoading(),$.ajax({url:url_taoxi_source_detail,data:e.send,type:"post",dataType:"json",timeout:1e4,success:function(t){removeLoading(),checkStatus(t,(function(){e.allGoodsData=t.data,o(1)}))},error:function(){removeLoading(),layer.alert("请求失败")}}),e.sel_s1="全部",n("#xm-select-s1",e.xm_arr3),e.sel_s2="payment_amt",n("#xm-select-s2",e.xm_arr1)}function o(e){var t=a;for(var r in t.goods_data=[],1==e&&(t.arr_category1=[],t.arr_category2=[],t.arr_category3=[],t.arr_brand=[],t.sel_category1=[],t.sel_category2=[],t.sel_category3=[],t.sel_brand=[]),t.allGoodsData){(c=t.allGoodsData[r]).shop_name=changeShopName(c.shop_id,t.arr_shop),c.pay_conversion_rate=(100*changeChu(c.payment_buyers_qty,c.visitors)).toFixed(2),c.customer_price=changeChu(c.payment_amt,c.payment_buyers_qty).toFixed(0),c.unit_price=changeChu(c.payment_amt,c.payment_qty).toFixed(0),1==e&&s(c),t.goods_data.push(c)}function s(e){function a(t,a){""==e[a]&&(e[a]="其他"),0==t.hasOwnProperty(e[a])&&(t[e[a]]={name:e[a],value:e[a]},"category2"==a&&(t[e[a]].parent=e.category1),"category3"==a&&(t[e[a]].parent=e.category2))}a(t.arr_category1,"category1"),a(t.arr_category2,"category2"),a(t.arr_category3,"category3"),a(t.arr_brand,"brand")}1==e&&(t.arr_category1=Object.values(t.arr_category1),t.arr_category2=Object.values(t.arr_category2),t.arr_category3=Object.values(t.arr_category3),t.arr_brand=Object.values(t.arr_brand),n("#xm-category1",Object.values(t.arr_category1)),n("#xm-category2",Object.values(t.arr_category2)),n("#xm-category3",Object.values(t.arr_category3)),function(e,t){var r=a;xmSelect.render({direction:"down",el:e,size:"mini",height:"auto",toolbar:{show:!0,showIcon:!1,list:["CLEAR"]},filterable:!0,model:{label:{type:"text"}},theme:{color:"#ED6D00"},data:t,on:function(t){"#xm-brand"==e&&(r.sel_brand=[],t.arr.length>0&&(r.sel_brand=t.arr.map((function(e){return e.value.toString()}))),o())}})}("#xm-brand",Object.values(t.arr_brand))),t.goods_data=t.filterThis(t.sel_eq,t.goods_data,"terminal"),t.goods_data=t.filterThis(t.sel_shop,t.goods_data,"shop_id"),t.goods_data=t.filterThis(t.sel_brand,t.goods_data,"brand"),t.goods_data=t.filterThis(t.sel_category1,t.goods_data,"category1"),t.goods_data=t.filterThis(t.sel_category2,t.goods_data,"category2"),t.goods_data=t.filterThis(t.sel_category3,t.goods_data,"category3"),t.goods_data=t.filterThis(t.sel_s1,t.goods_data,"traffic_source");var l=[],d=[];for(var r in t.goods_data){var c,m=(c=t.goods_data[r]).statistics_date,_=c.model_num;0==l.hasOwnProperty(_)&&(l[_]=[]),l[_].push(c),-1==d.indexOf(m)&&d.push(m)}t.date_arr2=d,t.goods_arr2=t.g1("traffic_source",l),i()}function i(){var e=(r=a).date_arr2.sort().map((function(e){return{title:e,sort:!1,minWidth:130,templet:function(t){var a=0,o=t.data,i=0,n=0,s=0,l=0,d=0,c=0;for(var m in o){var _=o[m];_.statistics_date==e&&(i=changeSum(i,_[r.sel_s2]),n=changeSum(n,_.payment_amt),s=changeSum(s,_.payment_qty),l=changeSum(l,_.visitors),d=changeSum(d,_.shopping_cart_qty),c=changeSum(c,_.payment_buyers_qty)),a=i,"pay_conversion_rate"==r.sel_s2&&(a=(100*changeChu(c,l)).toFixed(2)),"customer_price"==r.sel_s2&&(a=changeChu(n,c).toFixed(0)),"unit_price"==r.sel_s2&&(a=changeChu(n,s).toFixed(0))}return""==r.sel_s2&&(a=""),a}}})),t=[{title:"商品/来源",field:"name",sort:!1,minWidth:130,templet:function(e){var t;if(e.pla){var a="layui-icon-reduce-circle";0==e.showZi&&(a="layui-icon-add-circle"),t='<span lay-event="edit"><i class="layui-icon '+a+' tbtn"></i>'+e.name+"</span>"}else t='<span style="margin-left: 20px;" parent_pla='+e.parent_pla+">"+e.name+"</span>";return t}}].concat(e),r=a,o=layui.table;o.render({elem:"#table_shop_source_detail",id:"table_shop_source_detail",data:r.goods_arr2,limit:10,page:!0,cols:[t]}),r.t_name=[],o.on("tool(table_shop_source_detail)",(function(e){var t=e.data.name,a=r.t_name.indexOf(t);-1==a?r.t_name.push(t):r.t_name.splice(a,1);var i=[],n=r.goods_arr2;for(var s in n){var l=n[s];r.t_name.indexOf(l.pla)>-1&&(l.showZi=!1),-1==r.t_name.indexOf(l.pla)&&(l.showZi=!0),-1==r.t_name.indexOf(l.parent_pla)&&i.push(l)}o.reload("table_shop_source_detail",{data:i})}))}function n(e,t){var r=a;xmSelect.render({direction:"down",el:e,size:"mini",radio:!0,height:"auto",toolbar:{show:!0,showIcon:!1,list:["CLEAR"]},filterable:!0,model:{icon:"hidden",label:{type:"text"}},theme:{color:"#ED6D00"},data:t,on:function(t){if("#xm-category1"==e){if(r.sel_category1=[],r.sel_category2=[],r.sel_category3=[],t.arr.length>0){var a=[];r.sel_category1=t.arr.map((function(e){return r.arr_category2.forEach((function(t){e.value==t.parent&&a.push(t)})),e.value.toString()})),n("#xm-category2",a);var s=[];a.forEach((function(e){r.arr_category3.forEach((function(t){e.value==t.parent&&s.push(t)}))})),n("#xm-category3",s)}else n("#xm-category2",r.arr_category2),n("#xm-category3",r.arr_category3);o()}if("#xm-category2"==e){if(r.sel_category2=[],r.sel_category3=[],t.arr.length>0){a=[];r.sel_category2=t.arr.map((function(e){return r.arr_category3.forEach((function(t){e.value==t.parent&&a.push(t)})),e.value.toString()})),n("#xm-category3",a)}else n("#xm-category3",r.arr_category3);o()}"#xm-category3"==e&&(r.sel_category3=[],t.arr.length>0&&(r.sel_category3=t.arr.map((function(e){return e.value.toString()}))),o()),"#xm-select-s2"==e&&(r.sel_s2=[],t.arr.length>0&&(r.sel_s2=t.arr.map((function(e){return e.value.toString()}))),i()),"#xm-select-s1"==e&&(r.sel_s1=[],t.arr.length>0&&(r.sel_s1=t.arr.map((function(e){return e.value.toString()}))),o())}})}function s(){var e=a;e.send3=e.send,e.send3.prd_id="590716085952",e.sel_goods=["590716085952"],e.sel_goods3=e.sel_goods,e.xm_sa1="全部",e.xm_sa2="payment_amt",e.xm_sd="payment_amt",m("#xm-select-sa1",e.xm_arr3),m("#xm-select-sa2",e.xm_arr1),m("#xm-select-sd",e.xm_arr1),function(){var e=a,t=layui.form;t.render(),t.on("checkbox(dx3)",(function(t){var a=t.value,r=!t.elem.checked;e.title3[a].hide=r,layui.table.reload("table_sda1",{cols:[e.title3]})}))}(),l()}function l(){var e=a;addLoading(),$.ajax({url:url_taoxi_source_analysis,type:"post",dataType:"json",data:e.send3,timeout:1e4,success:function(t){removeLoading(),checkStatus(t,(function(){e.allGoodsData3=t.data,d(),c()}))},error:function(){removeLoading(),layer.alert("请求失败")}})}function d(){var e=a;e.date_arr3=[];var t=e.filterThis(e.sel_eq,e.allGoodsData3,"terminal");for(var r in t=e.filterThis(e.xm_sa1,t,"traffic_source")){var o=t[r],i=o.statistics_date;0==e.date_arr3.hasOwnProperty(i)&&(e.date_arr3[i]=[]),e.date_arr3[i].push(o)}e.date_arr3;var n=e.sel_goods.map((function(e,t){if(e)return"商品"+(t+1)}));n=n.filter((function(e){return e}));var s=["日期"].concat(n),l=e.changeEarchData(e.sel_goods3,e.date_arr3,"prd_no",e.xm_sa2),d=[s];d=d.concat(l),polygonal("echart_sourceTrend",d)}function c(){var e=a,t=e.filterThis(e.sel_eq,e.allGoodsData3,"terminal");for(var r in e.goods_data3=[],t){var o=(n=t[r]).traffic_source;0==e.goods_data3.hasOwnProperty(o)&&(""==o&&(o="其他"),e.goods_data3[o]=[]),e.goods_data3[o].push(n)}var i=[];for(var r in e.goods_data3){var n,s={name:r,data:n=e.goods_data3[r]};i.push(s)}var l=layui.table,d=[];if(1==e.sel_goods3.length){var c,m,_;e.title3=[{field:"name",title:"来源",sort:!1,minWidth:195},{title:"支付金额(元)",sort:!1,minWidth:130,templet:function(t){return c=e.ts(t,"payment_amt")}},{title:"访客数(人)",sort:!1,minWidth:130,templet:function(t){return _=e.ts(t,"visitors")}},{title:"加购人数(人)",sort:!1,minWidth:130,templet:function(t){return e.ts(t,"shopping_cart_qty")}},{title:"支付买家数(人)",sort:!1,minWidth:130,templet:function(t){return m=e.ts(t,"payment_buyers_qty")}},{title:"支付转化率(%)",sort:!1,minWidth:130,templet:function(e){return(100*changeChu(m,_)).toFixed(2)}},{title:"客单价(元)",sort:!1,minWidth:130,templet:function(e){return changeChu(c,m).toFixed(0)}}],d=e.title3}else{var h=e.sel_goods.map((function(t,a){if(t)return{title:"商品"+(a+1),sort:!1,minWidth:130,templet:function(a){var r=0,o=a.data,i=0,n=0,s=0,l=0,d=0,c=0;for(var m in o){var _=o[m];_.prd_no==t&&(i=changeSum(i,_[e.xm_sd]),n=changeSum(n,_.payment_amt),s=changeSum(s,_.payment_qty),l=changeSum(l,_.visitors),d=changeSum(d,_.shopping_cart_qty),c=changeSum(c,_.payment_buyers_qty)),r=i,"pay_conversion_rate"==e.xm_sd&&(r=(100*changeChu(c,l)).toFixed(2)),"customer_price"==e.xm_sd&&(r=changeChu(n,c).toFixed(0)),"unit_price"==e.xm_sd&&(r=changeChu(n,s).toFixed(0))}return""==e.xm_sd&&(r=""),r}}}));h=h.filter((function(e){return e})),d=[{title:"商品/来源",field:"name",sort:!1,minWidth:130}].concat(h)}l.render({id:"table_sda1",elem:"#table_sda1",data:i,cols:[d],limit:10,page:!0})}function m(e,t){var r=a,o=xmSelect.render({direction:"down",el:e,size:"mini",radio:!0,height:"auto",toolbar:{show:!0,showIcon:!1,list:["CLEAR"]},filterable:!0,model:{icon:"hidden",label:{type:"text"}},theme:{color:"#ED6D00"},height:400,data:t,on:function(t){if("#xm-goods1"==e){var a=_(t);r.sel_goods[0]=a,r.send3.prd_id=a,r.sel_goods3=r.sel_goods.filter((function(e){if(e)return e})),l()}if("#xm-goods2"==e){var o=_(t);r.sel_goods[1]=o,r.send3.prd_id2=o,r.sel_goods3=r.sel_goods.filter((function(e){if(e)return e})),l()}if("#xm-goods3"==e){var i=_(t);r.sel_goods[2]=i,r.send3.prd_id3=i,r.sel_goods3=r.sel_goods.filter((function(e){if(e)return e})),l()}if("#xm-select-sa1"==e){var n=_(t);r.xm_sa1=n,d()}if("#xm-select-sa2"==e){var s=_(t);r.xm_sa2=s,d()}if("#xm-select-sd"==e){var m=_(t);r.xm_sd=m,c()}function _(e){return e.arr.length>0?e.arr[0].value:""}}});"#xm-goods1"==e&&o.setValue([r.sel_goods[0]])}}]);