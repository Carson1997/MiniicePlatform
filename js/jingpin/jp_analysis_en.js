!function(t){var e={};function a(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.m=t,a.c=e,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)a.d(i,s,function(e){return t[e]}.bind(null,s));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=0)}([function(t,e){new Vue({el:"#vue",data:{send:{date:"2020-01-01_2020-06-30",date_type:"1",prd_id:"590716085952",platform:"1"},time_data:{start_time:"",end_time:""},dateValue:"",dateType:"daterange",selectDate:"---",defaultValue:"",dataType:1,pickOption:{firstDayOfWeek:1,disabledDate:function(t){}},pickOptionMonth:{firstDayOfWeek:1,disabledDate:function(t){}},selectDateShow:"2020-01-01_2020-06-30",daterange:[],monthrange:[],sel_goods:["590716085952"],payment_amt:[],payment_qty:[],visitors:[],shopping_cart:[],payment_collect_qty:[],pay_conversion_rate:[],customer_price:[],unit_price:[],s_tar:"payment_amt",sel_pla:"1",sel_s1:"全部",sel_s2:"payment_amt"},mounted:function(){this.initLayui(),this.initConTop(),this.initSelect(),this.initHeZiClick(),this.getGoods(),this.getShop()},methods:{mergeHandle:function(t){this.defaultValue=t.end_time,limitDayBegin=new Date(t.start_time.replace("-","/")).getTime(),limitDayEnd=new Date(t.end_time.replace("-","/")).getTime(),this.pickOption.disabledDate=function(t){if(limitDayBegin>t.getTime()||limitDayEnd<t.getTime())return t};var e=moment(limitDayEnd).endOf("month").format("YYYY-MM-DD"),a=limitDayEnd;if(t.end_time!=e){var i=moment(t.end_time).subtract(1,"months").format("YYYY-MM-DD");a=moment(i).endOf("month").format("YYYY-MM-DD"),a=new Date(a).getTime()}this.pickOptionMonth.disabledDate=function(t){return a>limitDayBegin?limitDayBegin>t.getTime()||a<t.getTime()?t:void 0:t}},selectLis:function(t,e){this.dataType=e;var a=this.time_data;this.dateType!=t?(this.dateValue="",this.dateType=t,this.mergeHandle(a)):this.mergeHandle(a),"daterange"==t&&$("#datePicker1").find(".el-date-editor--daterange")[0].click(),"week"==t&&($("#datePicker1").find(".el-date-editor--daterange")[1].click(),$(".available").removeClass("in-range start-date"),$(".available").removeClass("in-range end-date")),"monthrange"==t&&$("#datePicker1").find(".el-date-editor--monthrange").click()},dateClick:function(t){$(".wordClick").removeClass("wordClick");var e="";if("date"==this.dateType)e=t+"_"+t,$($(".word")[0]).addClass("wordClick");else if("week"==this.dateType){e=(a=moment(t).isoWeekday(1).week(moment(t).isoWeekday(1).week()).startOf("isoweek").format("YYYY-MM-DD"))+"_"+(i=moment(t).isoWeekday(1).week(moment(t).isoWeekday(1).week()).endOf("isoweek").format("YYYY-MM-DD")),$($(".word")[1]).addClass("wordClick")}else if("month"==this.dateType){e=(a=moment(t).month(moment(t).month()).startOf("month").format("YYYY-MM-DD"))+"_"+(i=moment(t).month(moment(t).month()).endOf("month").format("YYYY-MM-DD")),$($(".word")[2]).addClass("wordClick")}if(this.selectDate=e,"week"==this.dateType){$($(".word")[1]).addClass("wordClick"),this.send.date_type=2;var a=moment(t[0]).isoWeekday(1).week(moment(t[0]).isoWeekday(1).week()).startOf("isoweek").format("YYYY-MM-DD"),i=moment(t[1]).isoWeekday(1).week(moment(t[1]).isoWeekday(1).week()).endOf("isoweek").format("YYYY-MM-DD");this.selectDateShow=a+"_"+i,this.send.date=this.selectDateShow}if("daterange"==this.dateType&&($($(".word")[0]).addClass("wordClick"),this.selectDateShow=t[0]+"_"+t[1],this.send.date=this.selectDateShow,this.send.date_type=1),"monthrange"==this.dateType){$($(".word")[2]).addClass("wordClick");e=(a=moment(t[0]).month(moment(t[0]).month()).startOf("month").format("YYYY-MM-DD"))+"_"+(i=moment(t[1]).month(moment(t[1]).month()).endOf("month").format("YYYY-MM-DD"));this.selectDateShow=t[0].substr(0,7)+"_"+t[1].substr(0,7),this.send.date=e,this.send.date_type=3}this.daterange="",this.dateValue="",this.monthrange="",this.getPlaData()},initLayui(){layui.form.render()},initConTop(){var t=$(".fixedTitle").height()+10;$(".layui-fluid").css("margin-top",t)},initSelect(){this.selectRadio("#xm-select2",[{name:"支付金额",value:"payment_amt",selected:!0},{name:"访客数",value:"visitors"},{name:"支付买家数",value:"payment_buyers_qty"},{name:"支付转化率",value:"pay_conversion_rate"},{name:"客单价",value:"customer_price"}]);this.selectRadio("#xm-platform",[{name:"淘宝",value:"1",selected:!0},{name:"京东",value:"2"},{name:"苏宁",value:"3"}]);this.selectRadio("#xm-select1",[{name:"全部",value:"全部",selected:!0},{name:"淘宝首页",value:"淘宝首页"},{name:"天猫首页",value:"天猫首页"},{name:"淘宝搜索",value:"淘宝搜索"},{name:"天猫搜索",value:"天猫搜索"},{name:"直通车",value:"直通车"},{name:"淘宝客",value:"淘宝客"},{name:"淘宝其他店铺",value:"淘宝其他店铺"}])},clickTitleIcon(){var t,e,a=$(".titleIcon i").attr("class"),i=$(".fixedTitle").height(),s=$(".layui-fluid").offset().top;-1!=a.indexOf("layui-icon-up")?(this.content_top=s,t=10,e=i,$(".titleIcon i").attr("class","layui-icon layui-icon-down")):($(".titleIcon i").attr("class","layui-icon layui-icon-up"),t=this.content_top,e=0),$(".fixedTitle").animate({"margin-top":"-"+e},".1s"),$(".layui-fluid").animate({"margin-top":t},".1s")},initHeZiClick(){var t=this;$(".myBorderHeZi").click((function(){$(this).siblings().removeClass("selectHezi"),$(this).addClass("selectHezi"),t.s_tar=$(this).attr("data"),t.filterData1()}))},getShop(){var t=this;addLoading(),$.ajax({url:url_shop,type:"get",dataType:"json",timeout:1e4,success:function(e){removeLoading(),checkStatus(e,(function(){e.data.length>0&&(t.time_data.start_time=e.data[0].data_star,t.time_data.end_time=e.data[0].data_end,t.selectDateShow=e.data[0].data_star+"_"+e.data[0].data_end,t.daterange=[e.data[0].data_star,e.data[0].data_end],t.send.date=t.selectDateShow),t.getPlaData()}))},error:function(){removeLoading(),layer.alert("请求失败")}})},getGoods(){var t=this;addLoading(),$.ajax({url:url_jp_goods,type:"get",dataType:"json",timeout:1e4,success:function(e){removeLoading(),checkStatus(e,(function(){var a=e.data;t.fillGoodsSelect(a)}))},error:function(){removeLoading(),layer.alert("请求失败")}})},fillGoodsSelect(t){var e=[],a=[];for(var i in t){t[i];if(-1==e.indexOf(t[i].prd_id)){e.push(t[i].prd_id);var s={name:t[i].model_num,value:t[i].prd_id};a.push(s)}}this.arr_goods=a,this.selectRadio("#xm-goods1",this.arr_goods),this.selectRadio("#xm-goods2",this.arr_goods),this.selectRadio("#xm-goods3",this.arr_goods)},selectRadio(t,e){var a=this,i=xmSelect.render({direction:"down",el:t,size:"mini",radio:!0,toolbar:{show:!0,showIcon:!1,list:["CLEAR"]},filterable:!0,height:400,model:{icon:"hidden",label:{type:"text"}},theme:{color:"#ED6D00"},data:e,on:function(e){if("#xm-platform"==t){var i=l(e);a.send.platform=i,a.sel_pla=i,a.getPlaData()}if("#xm-goods1"==t){var s=l(e);a.sel_goods[0]=s,a.send.prd_id=s,a.getPlaData()}if("#xm-goods2"==t){var n=l(e);a.sel_goods[1]=n,a.send.prd_id2=n,a.getPlaData()}if("#xm-goods3"==t){var o=l(e);a.sel_goods[2]=o,a.send.prd_id3=o,a.getPlaData()}if("#xm-select1"==t){var r=l(e);a.sel_s1=r,a.filterData2()}if("#xm-select2"==t){var d=l(e);a.sel_s2=d,a.filterData2()}function l(t){return t.arr.length>0?t.arr[0].value:""}}});"#xm-goods1"==t&&i.setValue([a.sel_goods[0]])},getPlaData(){var t=this;addLoading(),$.ajax({url:url_jp_flowAnalysis,type:"post",data:t.send,dataType:"json",timeout:1e4,success:function(e){removeLoading(),checkStatus(e,(function(){t.allPlaData=e.data.pro,t.filterData1(),t.allFlowData=e.data.flow,t.filterData2()}))},error:function(){removeLoading(),layer.alert("请求失败")}})},filterData1(){this.payment_amt=[],this.payment_qty=[],this.visitors=[],this.shopping_cart=[],this.payment_collect_qty=[],this.pay_conversion_rate=[],this.customer_price=[],this.unit_price=[],this.pla_data=[],this.date_arr=[];var t=this.allPlaData;for(var e in t=this.filterThis(this.sel_pla,t,"platform"),this.sel_goods){var a=this.sel_goods[e];a&&(this.pla_data[a]=[])}for(var i in t){var s=(l=t[i]).statistics_date;0==this.date_arr.hasOwnProperty(s)&&(this.date_arr[s]=[]),this.date_arr[s].push(l);var n=l.prd_id;this.pla_data[n]&&this.pla_data[n].push(l)}for(var i in this.pla_data){var o,r,d,l=this.pla_data[i],h=0,m=0,c=0,u=0,_=0;for(var p in l){var f=l[p];h=changeSum(h,f.payment_amt),m=changeSum(m,f.payment_qty),c=changeSum(c,f.visitors),u=changeSum(u,f.shopping_cart),_=changeSum(_,f.payment_collect_qty)}var g=this.sel_goods.indexOf(i),y="竞品"+g;0==g&&(y="我的竞品"),this.payment_amt.push({pla:y,data:h}),this.payment_qty.push({pla:y,data:m}),this.visitors.push({pla:y,data:c}),this.shopping_cart.push({pla:y,data:u}),this.payment_collect_qty.push({pla:y,data:_}),o=(100*changeChu(_,c)).toFixed(2),r=changeChu(h,_).toFixed(0),d=changeChu(h,m).toFixed(0),this.pay_conversion_rate.push({pla:y,data:o}),this.customer_price.push({pla:y,data:r}),this.unit_price.push({pla:y,data:d})}this.fillEachart(this.date_arr,this.s_tar,"echart_goodsTrend")},fillEachart(t,e,a){var i=t,s=this.sel_goods.map((function(t,e){if(t)return 0==e?"我的商品":"竞品"+e}));s=s.filter((function(t){return t}));var n=["日期"].concat(s),o=[];for(var r in i){var d=i[r];if("week"==this.dateType){var l=r.split("-")[0];r=l+"年第"+getWeekInYear(r)+"周"}if("monthrange"==this.dateType){var h=r.split("-");r=h[0]+"-"+h[1]}h=[r];for(var m in this.sel_goods){var c=this.sel_goods[m],u=0,_=0,p=0,f=0,g=0,y=0;for(var v in d){var D=d[v];c!=D.prd_id&&c!=D.prd_no||(u=changeSum(u,D[e]),_=changeSum(_,D.payment_amt),p=changeSum(p,D.payment_qty),f=changeSum(f,D.visitors),g=changeSum(g,D.shopping_cart),y=changeSum(y,D.payment_collect_qty),D.payment_buyers_qty&&(y=changeSum(0,D.payment_buyers_qty)))}"pay_conversion_rate"==e&&(u=(100*changeChu(y,f)).toFixed(2)),"customer_price"==e&&(u=changeChu(_,y).toFixed(0)),"unit_price"==e&&(u=changeChu(_,p).toFixed(0)),h.push(u)}o.push(h)}data_all=[n],o.sort((function(t,e){return new Date(t[0]).getTime()-new Date(e[0]).getTime()})),data_all=data_all.concat(o),polygonal(a,data_all)},filterData2(){this.flow_data=[],this.date_arr2=[];var t=this.allFlowData;for(var e in t=this.filterThis(this.sel_goods,t,"prd_id"),t=this.filterThis(this.sel_s1,t,"traffic_source"),this.sel_goods){var a=this.sel_goods[e];a&&(this.flow_data[a]=[])}for(var i in t){var s=t[i],n=s.statistics_date;0==this.date_arr2.hasOwnProperty(n)&&(this.date_arr2[n]=[]),this.date_arr2[n].push(s)}this.fillEachart(this.date_arr2,this.sel_s2,"echart_sourceTrend")},filterThis(t,e,a){if(!e)return[];var i=e;return t.length>0&&(i=e.filter((function(e){if(t.indexOf(e[a])>-1&&""!=e[a])return e}))),"全部"==t&&(i=e),i}}})}]);