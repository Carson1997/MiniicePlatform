!function(e){var t={};function a(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=t,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(i,n,function(t){return e[t]}.bind(null,n));return i},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t){new Vue({el:"#vue",data:{send:{date:"2020-01-01_2020-06-30",date_type:"1"},time_data:{start_time:"",end_time:""},dateValue:"",dateType:"daterange",selectDate:"---",defaultValue:"",dataType:1,pickOption:{firstDayOfWeek:1,disabledDate:function(e){}},pickOptionMonth:{firstDayOfWeek:1,disabledDate:function(e){}},selectDateShow:"2020-01-01_2020-06-30",daterange:[],monthrange:[],tap:1,sel_pla:"1",sel_s2:"payment_amt"},mounted:function(){this.initLayui(),this.initConTop(),this.initSelect(),this.initHeZiClick(),this.getShop()},methods:{mergeHandle:function(e){this.defaultValue=e.end_time,limitDayBegin=new Date(e.start_time.replace("-","/")).getTime(),limitDayEnd=new Date(e.end_time.replace("-","/")).getTime(),this.pickOption.disabledDate=function(e){if(limitDayBegin>e.getTime()||limitDayEnd<e.getTime())return e};var t=moment(limitDayEnd).endOf("month").format("YYYY-MM-DD"),a=limitDayEnd;if(e.end_time!=t){var i=moment(e.end_time).subtract(1,"months").format("YYYY-MM-DD");a=moment(i).endOf("month").format("YYYY-MM-DD"),a=new Date(a).getTime()}this.pickOptionMonth.disabledDate=function(e){return a>limitDayBegin?limitDayBegin>e.getTime()||a<e.getTime()?e:void 0:e}},selectLis:function(e,t){this.dataType=t;var a=this.time_data;this.dateType!=e?(this.dateValue="",this.dateType=e,this.mergeHandle(a)):this.mergeHandle(a),"daterange"==e&&$("#datePicker1").find(".el-date-editor--daterange")[0].click(),"week"==e&&($("#datePicker1").find(".el-date-editor--daterange")[1].click(),$(".available").removeClass("in-range start-date"),$(".available").removeClass("in-range end-date")),"monthrange"==e&&$("#datePicker1").find(".el-date-editor--monthrange").click()},dateClick:function(e){$(".wordClick").removeClass("wordClick");var t="";if("date"==this.dateType)t=e+"_"+e,$($(".word")[0]).addClass("wordClick");else if("week"==this.dateType){t=(a=moment(e).isoWeekday(1).week(moment(e).isoWeekday(1).week()).startOf("isoweek").format("YYYY-MM-DD"))+"_"+(i=moment(e).isoWeekday(1).week(moment(e).isoWeekday(1).week()).endOf("isoweek").format("YYYY-MM-DD")),$($(".word")[1]).addClass("wordClick")}else if("month"==this.dateType){t=(a=moment(e).month(moment(e).month()).startOf("month").format("YYYY-MM-DD"))+"_"+(i=moment(e).month(moment(e).month()).endOf("month").format("YYYY-MM-DD")),$($(".word")[2]).addClass("wordClick")}if(this.selectDate=t,"week"==this.dateType){$($(".word")[1]).addClass("wordClick"),this.send.date_type=2;var a=moment(e[0]).isoWeekday(1).week(moment(e[0]).isoWeekday(1).week()).startOf("isoweek").format("YYYY-MM-DD"),i=moment(e[1]).isoWeekday(1).week(moment(e[1]).isoWeekday(1).week()).endOf("isoweek").format("YYYY-MM-DD");this.selectDateShow=a+"_"+i,this.send.date=this.selectDateShow}if("daterange"==this.dateType&&($($(".word")[0]).addClass("wordClick"),this.selectDateShow=e[0]+"_"+e[1],this.send.date=this.selectDateShow,this.send.date_type=1),"monthrange"==this.dateType){$($(".word")[2]).addClass("wordClick");a=moment(e[0]).month(moment(e[0]).month()).startOf("month").format("YYYY-MM-DD"),i=moment(e[1]).month(moment(e[1]).month()).endOf("month").format("YYYY-MM-DD");console.log(moment(e[1]).month(moment(e[1]).month()));t=a+"_"+i;this.selectDateShow=e[0].substr(0,7)+"_"+e[1].substr(0,7),this.send.date=t,this.send.date_type=3}this.daterange="",this.dateValue="",this.monthrange="",1==this.tap&&this.getJpSellDetail(),2==this.tap&&this.getJpFlowDetail()},initLayui(){var e=this,t=layui.form;t.render(),t.on("checkbox(dx)",(function(t){var a=t.value,i=!t.elem.checked;e.title[a].hide=i,layui.table.reload("table_sell_detail",{cols:[e.title]})}))},initConTop(){var e=$(".fixedTitle").height()+10;$(".layui-fluid").css("margin-top",e)},initSelect(){this.arr_pla=[{name:"淘宝",value:"1",selected:!0},{name:"京东",value:"2"},{name:"苏宁",value:"3"}],this.selectRadio("#xm-platform",this.arr_pla)},selectRadio(e,t){var a=this;xmSelect.render({direction:"down",el:e,size:"mini",radio:!0,toolbar:{show:!0,showIcon:!1,list:["CLEAR"]},filterable:!0,height:400,model:{icon:"hidden",label:{type:"text"}},theme:{color:"#ED6D00"},data:t,on:function(t){if("#xm-platform"==e&&(a.sel_pla=i(t),1==a.tap&&a.fillSellTable(),2==a.tap)){if(1==a.sel_pla){var n=[{name:"支付金额",value:"payment_amt",selected:!0},{name:"访客数",value:"visitors"},{name:"支付买家数",value:"payment_buyers_qty"},{name:"支付转化率",value:"pay_conversion_rate"},{name:"客单价",value:"customer_price"}];a.sel_s1="全部",a.selectRadio("#xm-select-s2",n)}if(3==a.sel_pla){n=[{name:"访客数",value:"visitors",selected:!0}];a.selectRadio("#xm-select-s2",n),a.sel_s2="visitors"}a.getJpFlowDetail()}"#xm-select-s1"==e&&(a.sel_s1=i(t),a.fillFlowTable()),"#xm-select-s2"==e&&(a.sel_s2=i(t),a.fillFlowTable())}});function i(e){return e.arr.length>0?e.arr[0].value:""}},selectMore(e,t){xmSelect.render({direction:"down",el:e,size:"mini",model:{label:{type:"text"}},theme:{color:"#ED6D00"},data:t})},clickTitleIcon(){var e,t,a=$(".titleIcon i").attr("class"),i=$(".fixedTitle").height(),n=$(".layui-fluid").offset().top;-1!=a.indexOf("layui-icon-up")?(this.content_top=n,e=10,t=i,$(".titleIcon i").attr("class","layui-icon layui-icon-down")):($(".titleIcon i").attr("class","layui-icon layui-icon-up"),e=this.content_top,t=0),$(".fixedTitle").animate({"margin-top":"-"+t},".1s"),$(".layui-fluid").animate({"margin-top":e},".1s")},initHeZiClick(){$(".myBorderHeZi").click((function(){$(this).siblings().removeClass("selectHezi"),$(this).addClass("selectHezi")}))},getShop(){var e=this;addLoading(),$.ajax({url:url_shop,type:"get",dataType:"json",timeout:1e4,success:function(t){removeLoading(),checkStatus(t,(function(){t.data.length>0&&(e.time_data.start_time=t.data[0].data_star,e.time_data.end_time=t.data[0].data_end,e.selectDateShow=t.data[0].data_star+"_"+t.data[0].data_end,e.daterange=[t.data[0].data_star,t.data[0].data_end],e.send.date=e.selectDateShow),e.getJpSellDetail()}))},error:function(){removeLoading(),layer.alert("请求失败")}})},changeTap(e){e!=this.tap&&(1==e&&(this.tap=1,this.initSelect(),this.getJpSellDetail()),2==e&&(this.tap=2,this.jpFlowDetail()))},getJpSellDetail(){var e=this;addLoading(),$.ajax({url:url_jp_sellDetail,type:"post",data:e.send,dataType:"json",timeout:1e4,success:function(t){removeLoading(),checkStatus(t,(function(){e.allSellData=t.data,e.fillSellTable()}))},error:function(){removeLoading(),layer.alert("请求失败")}})},fillSellTable(){var e=this.filterThis(this.sel_pla,this.allSellData,"platform");for(var t in e){var a=e[t];a.payment_amt=parseFloat(a.payment_amt).toFixed(2),a.pay_conversion_rate=(100*changeChu(a.payment_buyers_qty,a.visitors)).toFixed(2),a.customer_price=changeChu(a.payment_amt,a.payment_buyers_qty).toFixed(0),a.unit_price=changeChu(a.payment_amt,a.payment_qty).toFixed(0)}var i=layui.table;this.title=[{field:"shop",title:"店铺",sort:!1,minWidth:170},{field:"model_num",title:"商品",sort:!1,minWidth:170},{field:"payment_amt",title:"支付金额(元)",sort:!1,minWidth:130},{field:"payment_qty",title:"支付件数(件)",sort:!1,minWidth:130},{field:"visitors",title:"访客数(人)",sort:!1,minWidth:130},{field:"shopping_cart_qty",title:"加购人数(人)",sort:!1,minWidth:130},{field:"payment_buyers_qty",title:"支付买家数(人)",sort:!1,minWidth:130},{field:"pay_conversion_rate",title:"支付转化率(%)",sort:!1,minWidth:130},{field:"customer_price",title:"客单价(元)",sort:!1,minWidth:130},{field:"unit_price",title:"件单价(元)",sort:!1,minWidth:130}],i.render({id:"table_sell_detail",elem:"#table_sell_detail",data:e,cols:[this.title],limit:10,page:!0})},filterThis(e,t,a){if(!t)return[];var i=t;return e.length>0&&(i=t.filter((function(t){if(e.indexOf(t[a])>-1&&""!=t[a])return t}))),"全部"==e&&(i=t),i},jpFlowDetail(){this.arr_pla=[{name:"淘宝",value:"1",selected:!0}],this.selectRadio("#xm-platform",this.arr_pla),this.sel_pla=1;this.sel_s1="全部",this.selectRadio("#xm-select-s1",[{name:"全部",value:"全部",selected:!0},{name:"淘宝首页",value:"淘宝首页"},{name:"天猫首页",value:"天猫首页"},{name:"淘宝搜索",value:"淘宝搜索"},{name:"天猫搜索",value:"天猫搜索"},{name:"直通车",value:"直通车"},{name:"淘宝客",value:"淘宝客"},{name:"淘宝其他店铺",value:"淘宝其他店铺"}]),this.selectRadio("#xm-select-s2",[{name:"支付金额",value:"payment_amt",selected:!0},{name:"访客数",value:"visitors"},{name:"支付买家数",value:"payment_buyers_qty"},{name:"支付转化率",value:"pay_conversion_rate"},{name:"客单价",value:"customer_price"}]),this.getJpFlowDetail()},getJpFlowDetail(){var e=this,t=e.send;t.platform=e.sel_pla,addLoading(),$.ajax({url:url_jp_flowDetail,type:"post",data:t,dataType:"json",timeout:1e4,success:function(t){removeLoading(),checkStatus(t,(function(){e.allFlowData=t.data,e.fillFlowTable()}))},error:function(){removeLoading(),layer.alert("请求失败")}})},fillFlowTable(){var e=this,t=e.allFlowData;t=e.filterThis(e.sel_s1,t,"traffic_source");var a=[],i=[];for(var n in t){var l=t[n],o=l.statistics_date;0==a.hasOwnProperty(l.model_num)&&(a[l.model_num]=[]),a[l.model_num].push(l),-1==i.indexOf(o)&&i.push(o)}e.goods_arr2=e.g1("traffic_source",a);var s=(i=i.sort()).map((function(t){return{title:t,sort:!1,minWidth:130,templet:function(a){var i=0,n=a.data,l=0,o=0,s=0,r=0,d=0,m=0;for(var c in n){var u=n[c];u.statistics_date==t&&(l=changeSum(l,u[e.sel_s2]),o=changeSum(o,u.payment_amt),s=changeSum(s,u.payment_qty),r=changeSum(r,u.visitors),d=changeSum(d,u.shopping_cart_qty),m=changeSum(m,u.payment_buyers_qty)),i=l,"pay_conversion_rate"==e.sel_s2&&(i=(100*changeChu(m,r)).toFixed(2)),"customer_price"==e.sel_s2&&(i=changeChu(o,m).toFixed(0)),"unit_price"==e.sel_s2&&(i=changeChu(o,s).toFixed(0))}return""==e.sel_s2&&(i=""),i}}})),r=[{title:"商品/来源",field:"name",sort:!1,minWidth:130,templet:function(e){var t;if(e.pla){var a="layui-icon-reduce-circle";0==e.showZi&&(a="layui-icon-add-circle"),t='<span lay-event="edit"><i class="layui-icon '+a+' tbtn"></i>'+e.name+"</span>"}else t='<span style="margin-left: 20px;" parent_pla='+e.parent_pla+">"+e.name+"</span>";return t}}].concat(s),d=layui.table;d.render({elem:"#table_source_detail",id:"table_source_detail",data:e.goods_arr2,limit:10,page:!0,cols:[r]}),e.t_name=[],d.on("tool(table_source_detail)",(function(t){var a=t.data.name,i=e.t_name.indexOf(a);-1==i?e.t_name.push(a):e.t_name.splice(i,1);var n=[],l=e.goods_arr2;for(var o in l){var s=l[o];e.t_name.indexOf(s.pla)>-1&&(s.showZi=!1),-1==e.t_name.indexOf(s.pla)&&(s.showZi=!0),-1==e.t_name.indexOf(s.parent_pla)&&n.push(s)}d.reload("table_source_detail",{data:n})}))},g1(e,t){var a=[];for(var i in t){var n=t[i],l=i,o={name:l,data:n,pla:l,showZi:!0};a.push(o);var s=[];for(var r in n){var d=n[r][e];0==s.hasOwnProperty(d)&&(s[d]=[]),s[d].push(n[r])}for(var m in s){var c=s[m];""==m&&(m="其他");var u={name:m,data:c,parent_pla:l};a.push(u)}}return a}}})}]);